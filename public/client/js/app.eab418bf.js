(function(t){function e(e){for(var i,o,c=e[0],r=e[1],l=e[2],d=0,h=[];d<c.length;d++)o=c[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&h.push(n[o][0]),n[o]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],i=!0,c=1;c<s.length;c++){var r=s[c];0!==n[r]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=s[0]))}return t}var i={},n={app:0},a=[];function o(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=i,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var u=r;a.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"21fb":function(t,e,s){t.exports=s.p+"img/expression.73c98a16.png"},"42e0":function(t,e){t.exports="data:image/png;base64,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"},4678:function(t,e,s){var i={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function n(t){var e=a(t);return s(e)}function a(t){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}n.keys=function(){return Object.keys(i)},n.resolve=a,t.exports=n,n.id="4678"},"56d7":function(t,e,s){"use strict";s.r(e);s("cadf"),s("551c"),s("f751"),s("097d");var i=s("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mini-im-container",class:{"mini-im-pc-container":!t.isMobile,"mini-im-container-no-pto":!t.isShowHeader}},[i("span",{directives:[{name:"show",rawName:"v-show",value:t.isMobile&&t.isInputPongIng&&!t.isShowHeader,expression:"isMobile && (isInputPongIng && !isShowHeader)"}],staticClass:"input-ing"},[t._v(t._s(t.inputPongIngString))]),t.isShowHeader?i("mt-header",{attrs:{fixed:"",title:t.isInputPongIng?t.inputPongIngString:"在线客服"}},[i("div",{attrs:{slot:"left"},slot:"left"},[i("mt-button",{attrs:{icon:"back"},on:{click:t.back}})],1),i("mt-button",{attrs:{slot:"right"},on:{click:t.headRightBtn},slot:"right"},[t.isArtificial?i("span",[t._v("结束会话")]):i("img",{attrs:{title:"人工客服",src:"http://qiniu.cmp520.com/kefu_icon_2000.png",alt:""}})])],1):t._e(),t.isMobile?t._e():i("div",{staticClass:"mini-im-pc-header"},[t._m(0),i("span",{directives:[{name:"show",rawName:"v-show",value:t.isInputPongIng,expression:"isInputPongIng"}]},[t._v(t._s(t.inputPongIngString))]),i("div",{staticClass:"right"},[t.isArtificial?t._e():i("img",{attrs:{title:"人工客服",src:"http://qiniu.cmp520.com/kefu_icon_2000.png",alt:""},on:{click:t.headRightBtn}}),t.isArtificial?i("span",{on:{click:t.headRightBtn}},[t._v("结束会话")]):t._e(),i("div",{staticClass:"close-btn",on:{click:t.clickCloseWindow}},[t._v("ㄨ")])])]),i("div",{ref:"miniImBody",staticClass:"mini-im-body"},[i("ul",{staticClass:"mini-im-chat-list"},[t.isLoadMorLoading?i("li",{staticClass:"message-loading"},[i("mt-spinner",{attrs:{color:"#26a2ff",size:20,type:"triple-bounce"}})],1):t._e(),t._l(t.viewMessage,(function(e,s){return i("li",{key:s},[e.isShowDate?[i("div",{staticClass:"mini-im-chat-item"},[i("div",{staticClass:"chat-content"},[i("div",{staticClass:"chat-body"},[[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[i("span",[t._v(t._s(t.$formatFromNowDate(e.timestamp,"YYYY年MM月DD日 HH:mm")))])])])]],2)])])]:t._e(),i("div",{staticClass:"mini-im-chat-item",class:{self:e.from_account==t.userInfo.id}},[t.isShowInfo(e.biz_type)?i("div",{staticClass:"chat-avatar"},[i("img",{attrs:{src:e.avatar}})]):t._e(),i("div",{staticClass:"chat-content"},[i("div",{staticClass:"chat-body"},[e.isShowCancel?[e.from_account==t.userInfo.id&&t.isShowInfo(e.biz_type)?i("span",{staticClass:"cancel-btn",on:{click:function(){return t.cancelMessage(e.key)}}},[t._v("撤回")]):t._e()]:t._e(),"text"==e.biz_type||"welcome"==e.biz_type?[i("div",{staticClass:"text"},[i("span",{domProps:{innerHTML:t._s(e.payload.replace(/\n/gi,"<br />"))}})])]:t._e(),"photo"==e.biz_type?[i("div",{staticClass:"photo"},[e.percent&&100!=e.percent?i("span",[t._v("上传中"+t._s(e.percent)+"%")]):t._e(),t.isMobile?i("img",{attrs:{src:e.payload,preview:"1"}}):i("img",{attrs:{src:e.payload},on:{click:function(s){return t.clickPhoto(e.payload)}}})])]:t._e(),"knowledge"==e.biz_type?[i("div",{staticClass:"knowledge"},[i("div",{staticClass:"title"},[t._v("以下是您关心的相关问题?")]),t._l(JSON.parse(e.payload),(function(e,s){return i("a",{key:s,attrs:{href:"javascript:void(0);"},on:{click:function(){return t.sendKnowledgeMessage(e.title)}}},[i("span",[t._v("• "+t._s(e.title))])])})),i("a",{on:{click:t.headRightBtn}},[t._v("• 以上都不是?我要找人工")])],2)]:t._e(),"end"==e.biz_type?[t._m(1,!0)]:t._e(),"timeout"==e.biz_type?[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[i("span",[t._v(t._s(e.payload))])])])]:t._e(),"system"==e.biz_type?[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[i("span",{domProps:{innerHTML:t._s(e.payload)}})])])]:t._e(),"cancel"==e.biz_type?[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[e.from_account==t.userInfo.id?i("span",[t._v("您撤回了一条消息")]):i("span",[t._v("对方撤回了一条消息")])])])]:t._e(),"transfer"==e.biz_type?[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[i("span",[t._v("已为您转接"+t._s(e.transfer_account)+"号客服")])])])]:t._e()],2)])])],2)}))],2),t.isNotNetWork?i("div",{staticClass:"no-network"},[i("img",{attrs:{src:s("42e0"),alt:""}}),i("span",[t._v("网络连接已断开，请重新加载尝试~")]),i("button",{on:{click:t.resetLoad}},[t._v("重新加载")])]):t._e()]),t.isLoading?i("div",{staticClass:"mini-im-loading"},[i("mt-spinner",{attrs:{type:"triple-bounce",color:"#26a2ff"}})],1):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showEmoji,expression:"showEmoji"}],staticClass:"mini-im-emoji"},[i("div",{staticClass:"mini-im-emoji-content"},t._l(t.emojis,(function(e,s){return i("span",{key:s,on:{click:function(){return t.clickEmoji(e)}}},[t._v(t._s(e))])})),0)]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.handshakeKeywordList.length>0,expression:"handshakeKeywordList.length > 0"}],staticClass:"mini-im-knowledge"},[i("div",{staticClass:"mask",on:{click:function(e){t.handshakeKeywordList=[]}}}),i("span",[t._v("以下是您关心的相关问题?")]),i("ul",t._l(t.handshakeKeywordList,(function(e,s){return i("li",{key:s,staticClass:"sendKnowledgeMessage",attrs:{data:e.title},on:{click:function(s){!t.isIOS&&t.sendKnowledgeMessage(e.title)}}},[t._v("• "+t._s(e.title))])})),0)]),i("div",{staticClass:"mini-im-tabbar-input"},[i("span",{staticClass:"photo-btn"},[i("img",{attrs:{src:s("bed0"),alt:""}}),i("input",{attrs:{onClick:"this.value = null",type:"file",accept:"image/*"},on:{change:t.sendPhotoMessageEvent}})]),i("span",{staticClass:"expression-btn",on:{click:function(e){t.showEmoji=!t.showEmoji}}},[i("img",{attrs:{src:s("21fb"),alt:""}})]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.isMobile&&!t.isShowHeader,expression:"isMobile && !isShowHeader"}],staticClass:"serverci",class:{on:!t.isArtificial},on:{click:t.headRightBtn}},[t.isArtificial?i("span",[t._v("结束会话")]):i("img",{attrs:{title:"人工客服",src:"http://qiniu.cmp520.com/bfbfbf.png",alt:""}})]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.chatValue,expression:"chatValue"}],ref:"textarea",staticStyle:{"vertical-align":"top",outline:"none"},attrs:{maxlength:"200",placeholder:"请用一句话描述您的问题~"},domProps:{value:t.chatValue},on:{keyup:[function(e){return e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.keyUpEvent(e)},function(e){return!e.type.indexOf("key")&&13!==e.keyCode&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.shiftKey?t.enterShift(e):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.enterSendMessage(e)}],submit:t.sendTextMessage,focus:t.chatInputFocus,blur:t.chatInputBlur,input:function(e){e.target.composing||(t.chatValue=e.target.value)}}}),i("button",{ref:"sendButton",staticClass:"mini-input-send",attrs:{type:"button"}},[t._v("发送")])])],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"title"},[s("img",{attrs:{src:"http://qiniu.cmp520.com/kefu_icon_2000.png",alt:""}}),s("span",[t._v("在线客服")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"system"},[s("div",{staticClass:"content"},[s("span",[t._v("本次会话结束，感谢您的支持！")])])])}],o=(s("c5f6"),s("7f7f"),s("28a5"),s("386d"),s("4917"),s("bc3a")),c=s.n(o),r=s("76a0"),l=s.n(r),u=s("cea2"),d=s("1fba"),h=s("bb7f"),m={name:"app",data:function(){return{messages:[],isLoading:!0,isNotNetWork:!1,userLocal:"",isFirstGetMessage:!0,platform:5,uid:null,chatValue:"",emojis:h.emojiData,showEmoji:!1,userInfo:{},userAccount:null,companyInfo:null,uploadToken:null,isArtificial:!1,artificialAccount:null,robotInfo:null,robotAccount:null,isLoadMorEnd:!1,isUserSendLongTimeSystemMessage:!1,isAdminSendLongTimeSystemMessage:!1,isInputPongIng:!1,isLoadMorLoading:!1,isSendPong:!1,qiniuObservable:null,inputPongIngString:"对方正在输入...",scroll:null,isShowHeader:!0,isMobile:!0,handshakeKeywordList:[],searchHandshakeTimer:null}},created:function(){this.getLocal(),this.run()},computed:{account:function(){return this.isArtificial?this.artificialAccount:this.robotAccount},isIOS:function(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},isSafari:function(){return navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1},isJudgeBigScreen:function(){return this.$judgeBigScreen()},viewMessage:function(){for(var t=this.messages,e=0;e<t.length;e++)0==e&&(t[e].isShowDate=!0),e<t.length-1&&(t[e+1].isShowDate=!1,t[e+1].timestamp-120>t[e].timestamp&&(t[e+1].isShowDate=!0));return t}},mounted:function(){var t=this,e=this.queryToJson(location.search);e&&e.c&&localStorage.clear();var s=this.queryToJson(localStorage.getItem("urlQuery"));s&&(e=Object.assign({},s,e),e.u=s.u),e&&("0"==e.h&&(this.isShowHeader=!1),"0"==e.m&&(this.isMobile=!1,this.isShowHeader=!1),e.u&&(this.userAccount=parseInt(e.u)),e.p&&(this.platform=parseInt(e.p)),e.uid&&(this.uid=parseInt(e.uid)),"0"==e.r?(this.isArtificial=!0,this.artificialAccount=parseInt(e.a)):this.robotAccount=parseInt(e.a));var i=localStorage.getItem("isArtificial_"+this.userAccount),n=localStorage.getItem("artificialAccount_"+this.userAccount);"true"==i&&(this.isArtificial=!0,this.artificialAccount=parseInt(n)),setTimeout((function(){t.isLoading=!1,t.scroll=new d["a"](t.$refs.miniImBody,{click:!0,tab:!0,scrollY:!0,scrollbar:!0,bounceTime:400,preventDefaultException:{className:/(^|\s)text(\s|$)/},mouseWheel:!0}),t.scroll.on("touchEnd",(function(e){e.y>30&&t.loadMorData()})),t.addSendButtonTouchEventListener(),t.createLinkQuery(),t.scrollIntoBottom()}),500),this.onCheckIsOutSession(),document.addEventListener("paste",this.inputPaste,!1)},beforeDestroy:function(){this.toggleWindow(this.userAccount,0)},methods:{run:function(){var t=this;this.getAllhttp(),this.upLastActivity(),this.$mimcInstance.addEventListener("receiveP2PMsg",this.receiveP2PMsg),this.$mimcInstance.addEventListener("disconnect",(function(){console.log("链接断开！"),t.isNotNetWork=!0})),this.$mimcInstance.addEventListener("statusChange",(function(t,e,s,i){console.log("状态发生变化",t,e,s,i)})),this.$mimcInstance.addEventListener("serverAck",(function(e,s,i,n){console.log("发送消息服务器ack",e,s,i,n),localStorage.setItem("userLastCallBackMessageTime_"+t.userAccount,Date.now()),t.isUserSendLongTimeSystemMessage=!1})),this.onCheckIsloogTimeNotCallBack()},getLocal:function(){var t=this,e="";c.a.get("https://restapi.amap.com/v3/ip?key="+e).then((function(e){e.data.province&&(console.log(e.data.province+e.data.city),t.userLocal=e.data.province+e.data.city)})).catch((function(t){console.error(t)}))},initMimc:function(){var t=this,e=this.$mimcInstance,s=e.getLocalCacheUser(this.userAccount);this.userInfo=s;var i=this.userAccount?this.userAccount:s?s.id:0;e.init({type:0,address:this.userLocal,uid:this.uid,platform:this.platform,account_id:i},(function(s){s?(t.userInfo=s,t.userAccount=s.id,t.cleanRead(s.id),t.toggleWindow(s.id,1),e.login((function(){setTimeout((function(){t.getMessageRecord(),t.artificialAccount||(console.log("握手消息"),e.sendMessage("handshake",t.robotAccount,"")),t.scrollIntoBottom()}),500)}))):setTimeout((function(){return t.initMimc()}),1e3)})),this.onServciceLastMessageTimeNotCallBack()},resetLoad:function(){window.location.reload()},enterShift:function(t){this.isMobile||"Enter"!=t.code&&(this.chatValue=this.chatValue+"\n")},addSendButtonTouchEventListener:function(){var t=this;this.isIOS?document.addEventListener("touchstart",(function(e){"mini-input-send"==e.target.getAttribute("class")&&t.sendTextMessage(),"sendKnowledgeMessage"==e.target.getAttribute("class")&&(console.log("监听发送按钮触摸事件",e.target.getAttribute("data")),t.sendKnowledgeMessage(e.target.getAttribute("data")))}),!1):this.$refs.sendButton.addEventListener("click",this.sendTextMessage,!1)},cleanRead:function(t){c.a.get("/public/clean_read/"+t)},toggleWindow:function(t,e){c.a.put("/public/window/"+t,{window:e})},queryToJson:function(t){if(!t||""==t)return null;var e=t.substr(1,t.length).split("&");if(!e)return null;for(var s={},i=0;i<e.length;i++){var n=e[i].split("=");s[n[0]]=n[1]}return s},back:function(){history.go(-1)},isShowInfo:function(t){return-1==["end","transfer","cancel","timeout","system"].indexOf(t)},clickPhoto:function(t){if(-1==t.indexOf("http")){var e=new Image;e.src=t;var s=window.open("","_blank");s.document.write(e.outerHTML),s.document.title="图片",s.document.close()}else window.open(t)},upLastActivity:function(){var t=this;this.onCheckIsOutSession();var e=this.$mimcInstance.getLocalCacheUser(this.userAccount);e&&c.a.get("/public/activity/"+e.id),this.isArtificial&&localStorage.setItem("artificialTime_"+this.userAccount,Date.now()),setTimeout((function(){return t.upLastActivity()}),6e4)},onCheckIsOutSession:function(){var t=localStorage.getItem("artificialTime_"+this.userAccount);t&&(t=parseInt(t),Date.now()>t+6e5&&(this.isArtificial=!1,this.artificialAccount=null))},loadMorData:function(){var t=this;this.isLoadMorLoading||this.isLoadMorEnd||(this.isLoadMorLoading=!0,setTimeout((function(){t.getMessageRecord(),t.isLoadMorLoading=!1}),1e3))},localAdmin:function(t){var e=localStorage.getItem("admin_"+t);return e?JSON.parse(e):null},localRobot:function(t){var e=localStorage.getItem("robot_"+t);return e?JSON.parse(e):null},clickEmoji:function(t){this.showEmoji=!1,this.chatValue=this.chatValue+t,this.scrollIntoBottom()},sendPhotoMessageEvent:function(t){var e=t.target,s=e.files[0];this.sendPhotoMessage(s)},sendPhotoMessage:function(t){var e=new FileReader;e.readAsDataURL(t);var s,i=this,n=parseInt(1e4*Math.random()*(new Date).getTime())+t.name.substr(t.name.lastIndexOf("."));e.onload=function(){var e=function(){s.percent=0,i.qiniuObservable=null,i.removeMessage(i.userInfo.id,s.key),Object(r["Toast"])({message:"上传失败，请重新上传！"});var t=i.$mimcInstance,e=t.createLocalMessage("system",i.account,"您刚刚上传的图片失败了，请重新上传！");i.messages.push(i.handlerMessage(e)),i.scrollIntoBottom()},a=function(t){i.qiniuObservable=null,s.percent=100;var e=i.uploadToken.host+"/"+t;i.$mimcInstance.sendMessage("photo",i.account,e)};s=i.$mimcInstance.createLocalMessage("photo",i.account,this.result),s["percent"]=0,s.isShowCancel=!0,setTimeout((function(){s.isShowCancel=!1}),1e4),i.messages.push(i.handlerMessage(s));var o=Object.assign({},s);if(o.payload=i.uploadToken.host+"/"+n,i.$previewRefresh(),i.scrollIntoBottom(),1==i.uploadToken.mode){var l=new FormData;l.append("file",t),l.append("file_name",n),c.a.post("/public/upload",l).then((function(t){a(t.data.data)})).catch((function(){e()}))}else if(2==i.uploadToken.mode){var d={quality:.92,noCompressIfLarger:!0,maxWidth:1500};u["compressImage"](t,d).then((function(o){var l=u["upload"](o.dist,n,i.uploadToken.secret,{},{mimeType:null});i.qiniuObservable=l.subscribe({next:function(t){s.percent=Math.ceil(t.total.percent),t.total.size<1&&(i.qiniuObservable.unsubscribe(),i.cancelMessage(s.key),Object(r["Toast"])({message:"上传失败，该图片已损坏！"}))},error:function(){var s=new FormData;s.append("fileType","image"),s.append("fileName","file"),s.append("key",n),s.append("token",i.uploadToken.secret),s.append("file",t),c.a.post("https://upload.qiniup.com",s).then((function(){a(n)})).catch((function(){e()}))},complete:function(t){a(t.key)}})}))}}},scrollIntoBottom:function(){var t=this;setTimeout((function(){var e=t.$refs.miniImBody.querySelectorAll("li");t.scroll&&t.scroll.scrollToElement(e[e.length-1])}),50)},chatInputFocus:function(){this.scrollIntoBottom(),this.showEmoji=!1},chatInputBlur:function(){window.chatInputInterval=null,window.scroll(0,0)},getRobot:function(){var t=this;return c.a.get("/public/robot/1").then((function(e){var s=e.data.data;localStorage.setItem("robot_"+s.id,JSON.stringify(s)),t.robotAccount=s.id,t.robotInfo=s})).catch((function(t){Object(r["Toast"])({message:t.response.data.message})}))},getUploadSecret:function(){var t=this;return c.a.get("/public/secret").then((function(e){t.uploadToken=e.data.data}))},getCompanyInfo:function(){var t=this;return c.a.get("/public/company").then((function(e){t.companyInfo=e.data.data})).catch((function(t){Object(r["Toast"])({message:t.response.data.message})}))},getAllhttp:function(){var t=this;c.a.all([this.getRobot(),this.getCompanyInfo(),this.getUploadSecret()]).then(c.a.spread((function(){t.initMimc()}))).catch((function(){return setTimeout((function(){return t.getAllhttp()}),1e3)}))},receiveP2PMsg:function(t){if(console.log(t),"transfer"==t.biz_type){this.isArtificial=!0,this.artificialAccount=t.transfer_account;var e=JSON.parse(t.payload);localStorage.setItem("admin_"+e.id,JSON.stringify(e)),localStorage.setItem("adminLastCallBackMessageTime_"+e.id,Date.now()),this.isAdminSendLongTimeSystemMessage=!1}if(!this.isArtificial||"text"!=t.biz_type&&"photo"!=t.biz_type&&"cancel"!=t.biz_type||(localStorage.setItem("adminLastCallBackMessageTime_"+this.account,Date.now()),this.isAdminSendLongTimeSystemMessage=!1),"cancel"==t.biz_type&&this.removeMessage(t.from_account,t.payload),"end"!=t.biz_type&&"timeout"!=t.biz_type||(this.isArtificial=!1,this.artificialAccount=null),"pong"!=t.biz_type){if("search_knowledge"==t.biz_type)return this.handshakeKeywordList=[],void(""!=t.payload&&(this.handshakeKeywordList=JSON.parse(t.payload)));this.messagesPushMemory(t),this.scrollIntoBottom(),this.$previewRefresh(),window.parent.postMessage({newMessage:1},"*")}else this.inputPongIng()},inputPongIng:function(){var t=this;this.isInputPongIng||(this.isInputPongIng=!0,setTimeout((function(){t.inputPongIngString="对方正在输入."}),500),setTimeout((function(){t.inputPongIngString="对方正在输入.."}),1500),setTimeout((function(){t.inputPongIngString="对方正在输入...",t.isInputPongIng=!1}),3e3))},enterSendMessage:function(){this.isMobile||(this.sendTextMessage(),this.$refs.textarea.focus())},sendTextMessage:function(){if(0!=this.userInfo.online){var t=this.chatValue.trim();if(""!=t){var e=this.$mimcInstance,s=e.sendMessage("text",this.account,t);s.isShowCancel=!0,setTimeout((function(){return s.isShowCancel=!1}),1e4),this.messagesPushMemory(s),this.chatValue="",this.handshakeKeywordList=[]}}else Object(r["Toast"])({message:"您貌似掉线了"})},cancelMessage:function(t){var e=this.$mimcInstance,s=e.sendMessage("cancel",this.account,t);this.messagesPushMemory(s),this.removeMessage(this.userInfo.id,t),this.qiniuObservable&&this.qiniuObservable.unsubscribe()},sendKnowledgeMessage:function(t){this.handshakeKeywordList=[];var e=this.$mimcInstance,s=e.sendMessage("text",this.account,t);this.messagesPushMemory(s),this.chatValue=""},headRightBtn:function(){var t=this;if(!window.isClickHeadRightBtn){window.isClickHeadRightBtn=!0;var e=this.$mimcInstance;if(this.isArtificial)return r["MessageBox"].confirm("您确定关闭此次会话吗?","温馨提示! ").then((function(){var s=e.sendMessage("end",t.account,"");t.messagesPushMemory(s),t.isArtificial=!1,t.artificialAccount=null})),void setTimeout((function(){return window.isClickHeadRightBtn=!1}),3e3);var s=e.sendMessage("text",this.account,"人工");this.messagesPushMemory(s),setTimeout((function(){return window.isClickHeadRightBtn=!1}),3e3)}},messagesPushMemory:function(t){"pong"!=t.biz_type&&"handshake"!=t.biz_type&&"into"!=t.biz_type&&(this.messages.push(this.handlerMessage(t)),this.scrollIntoBottom())},handlerMessage:function(t){var e="http://qiniu.cmp520.com/avatar_degault_3.png",s=this.localAdmin(t.from_account),i=this.localRobot(t.from_account);return s&&t.from_account==s.id?(t.nickname=s.nickname,t.avatar=""==s.avatar?e:s.avatar):i&&t.from_account==i.id?(t.nickname=i.nickname,t.avatar=""==i.avatar?e:i.avatar):t.from_account==this.userInfo.id&&(t.nickname=this.userInfo.nickname,-1!=this.userInfo.nickname.indexOf(this.userInfo.id)&&(t.nickname="我"),t.avatar=""==this.userInfo.avatar?e:this.userInfo.avatar),t},getMessageRecord:function(){var t=this,e=20,s=this.userInfo.id,i=this.userInfo.token,n=0==this.messages.length?parseInt(((new Date).getTime()+" ").substr(0,10)):this.messages[0].timestamp;c.a.post("/public/messages",{timestamp:n,page_size:e,account:s},{headers:{token:i}}).then((function(s){var i=s.data.data.list||[];i.length<e&&(t.isLoadMorEnd=!0),0==t.messages.length&&i.length>0?(t.messages=s.data.data.list.map((function(e){return t.handlerMessage(e)})),t.scrollIntoBottom()):i.length>0&&(i=i.map((function(e){return t.handlerMessage(e)})),t.messages=i.concat(t.messages))})).catch((function(t){console.log(t)}))},keyUpEvent:function(){var t=this;this.isArtificial&&(this.isSendPong||(this.isSendPong=!0,setTimeout((function(){return t.isSendPong=!1}),100),this.$mimcInstance.sendMessage("pong",this.account,this.chatValue)))},removeMessage:function(t,e){for(var s=[],i=0;i<this.messages.length;i++)this.messages[i].key==e&&this.messages[i].from_account==t||s.push(this.messages[i]);this.messages=s},createLinkQuery:function(){var t=this.isArtificial?0:1,e=0==t?this.artificialAccount:this.robotAccount,s=this.isMobile?1:0,i=this.isShowHeader?1:0,n=this.platform?this.platform:1,a=this.userAccount?"&u="+this.userAccount:"",o=this.uid?"&uid="+this.uid:"",c="?h="+i+"&m="+s+"&p="+n+"&r="+t+"&a="+e+a+o;history.replaceState(null,null,c),null!=this.userAccount&&"null"!=this.userAccount&&""!=this.userAccount&&localStorage.setItem("urlQuery",c)},clickCloseWindow:function(){window.parent.postMessage({clickCloseWindow:!0},"*")},onCheckIsloogTimeNotCallBack:function(){var t=this,e=localStorage.getItem("userLastCallBackMessageTime_"+this.userAccount)||Date.now();if(this.isArtificial&&!this.isUserSendLongTimeSystemMessage&&Date.now()-e>=3e5){var s=this.$mimcInstance,i=s.createLocalMessage("system",this.account,"您已超过5分钟未回复消息，系统3分钟后将结束对话");this.messages.push(this.handlerMessage(i)),this.isUserSendLongTimeSystemMessage=!0,this.scrollIntoBottom()}setTimeout((function(){return t.onCheckIsloogTimeNotCallBack()}),1e4)},onServciceLastMessageTimeNotCallBack:function(){var t=this;if(this.robotInfo){var e=this.robotInfo.loog_time_wait_text,s=localStorage.getItem("adminLastCallBackMessageTime_"+this.account)||Date.now();if(this.isArtificial&&!this.isAdminSendLongTimeSystemMessage&&""!=e.trim()&&Date.now()-s>=12e4){var i=this.$mimcInstance,n=i.createLocalMessage("text",this.account,e);n.from_account=this.robotAccount,this.messages.push(this.handlerMessage(n)),this.isAdminSendLongTimeSystemMessage=!0,this.scrollIntoBottom()}setTimeout((function(){return t.onServciceLastMessageTimeNotCallBack()}),1e4)}},onSearchHandshake:function(){var t=this;if(this.chatValue&&!this.isArtificial){this.searchHandshakeTimer&&clearTimeout(this.searchHandshakeTimer);var e=this.$mimcInstance;this.searchHandshakeTimer=setTimeout((function(){e.sendMessage("search_knowledge",t.robotAccount,t.chatValue),t.searchHandshakeTimer=null}),500)}else this.handshakeKeywordList=[]},inputPaste:function(t){if(!this.isMobile){var e=this,s=t.clipboardData,i=window.navigator.userAgent;if(t.clipboardData&&t.clipboardData.items&&!(s.items&&2===s.items.length&&"string"===s.items[0].kind&&"file"===s.items[1].kind&&s.types&&2===s.types.length&&"text/plain"===s.types[0]&&"Files"===s.types[1]&&i.match(/Macintosh/i)&&Number(i.match(/Chrome\/(\d{2})/i)[1])<49))for(var n=0;n<s.items.length;n++){var a=s.items[n];if("file"==a.kind){var o=a.getAsFile();if(0===o.size)return;e.sendPhotoMessage(o)}}}}},watch:{messages:function(){var t=this;setTimeout((function(){t.scroll&&t.scroll.refresh(),t.$previewRefresh()}),50)},isArtificial:function(t){this.createLinkQuery(),localStorage.setItem("isArtificial_"+this.userAccount,t),localStorage.setItem("artificialTime_"+this.userAccount,Date.now()),t||localStorage.removeItem("artificialTime_"+this.userAccount)},artificialAccount:function(){localStorage.setItem("artificialAccount_"+this.userAccount,this.artificialAccount)},userInfo:function(){this.createLinkQuery()},chatValue:function(){this.onSearchHandshake()}}},f=m,g=(s("7faf"),s("2877")),p=Object(g["a"])(f,n,a,!1,null,null,null),b=p.exports,v=s("d1d4"),y=s.n(v),k=(s("394c"),s("aa35"),s("c1df")),w={install:function(t,e){t.prototype.$myMethod=function(){console.log(e)},t.prototype.$formatUnixDate=function(t,e){return k(parseInt(t+"000")).format(e)},t.prototype.$formatFromNowDate=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm";return k().format("YYYYMMDD")==k(parseInt(t+"000")).format("YYYYMMDD")?"今天 "+k(parseInt(t+"000")).format("HH:mm"):k(parseInt(t+"000")).format(e)},t.prototype.$robotNickname=function(t){for(var e,s=this.$store.getters.robots,i=0;i<s.length;i++)s[i].id==t&&(e=s[i].nickname);return e},t.prototype.$judgeBigScreen=function(){var t=!1,e=window.screen.height/window.screen.width,s=window.screen.height==window.screen.availHeight?1.8:1.65;return e>s&&(t=!0),t}}},M=w,I=(s("6b54"),{install:function(t,e){console.log(e),t.MimcInstance=t.prototype.$mimcInstance={user:null,robot:null,platform:5,fetchMIMCTokenResult:null,_receiveP2PMsgCallback:null,_statusChangeCallback:null,_serverAckCallback:null,_disconnectCallback:null,init:function(t,e){this.platform=t.platform,this.fetchMIMCToken(t,e),this.getRobot()},getLocalCacheUser:function(t){var e=localStorage.getItem("miniImAppUser_"+t);return e?JSON.parse(e):null},fetchMIMCToken:function(t,e){var s=this;c.a.post("/public/register",t).then((function(t){s.fetchMIMCTokenResult=t.data.data.token,localStorage.setItem("miniImAppUser_"+t.data.data.user.id,JSON.stringify(t.data.data.user)),console.log("MIMC初始化成功"),e&&e(t.data.data.user)})).catch((function(t){e&&e(null),console.log(t.response),Object(r["Toast"])({message:t.response.data.message})}))},getRobot:function(){var t=this;c.a.get("/public/robot/1").then((function(e){t.robot=e.data.data})).catch((function(t){Object(r["Toast"])({message:"mimc初始化失败,请刷新重试"+t.response.data.message})}))},pushMessage:function(t){var e=this;c.a.post("/public/message/push",{msgType:"NORMAL_MSG",payload:t}).then((function(s){console.log(s.data),200!=s.data["code"]&&setTimeout((function(){return e.pushMessage(t)}),300)})).catch((function(){setTimeout((function(){return e.pushMessage(t)}),300)}))},login:function(t){var e=this;try{if(this.user)return;var s=this.fetchMIMCTokenResult;this.user=new MIMCUser(s.data.appId,s.data.appAccount,"666"),this.user.registerP2PMsgHandler((function(t){var s=JSON.parse(window.Base64.decode(t.getPayload()));e._receiveP2PMsgCallback&&e._receiveP2PMsgCallback(s)})),this.user.registerFetchToken((function(){return s})),this.user.registerStatusChange((function(t,s,i,n){e._statusChangeCallback&&e._statusChangeCallback(t,s,i,n)})),this.user.registerServerAckHandler((function(t,s,i,n){e._serverAckCallback&&e._serverAckCallback(t,s,i,n)})),this.user.registerDisconnHandler((function(){e._disconnectCallback&&e._disconnectCallback()})),this.user.login(),window.mimcInstance=this,t&&t(),console.log("MIMC登录成功")}catch(i){console.log("MIMC登录失败"),setTimeout((function(){e.login()}),1e3)}},logout:function(){this.user&&(this.user.logout(),this.user=null)},addEventListener:function(t,e){switch(t){case"receiveP2PMsg":this._receiveP2PMsgCallback=e;break;case"statusChange":this._statusChangeCallback=e;break;case"serverAck":this._serverAckCallback=e;break;case"disconnect":this._disconnectCallback=e;break}},sendMessage:function(t,e){var s=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.user){var n={from_account:parseInt(this.fetchMIMCTokenResult.data.appAccount),to_account:parseInt(e),biz_type:t,version:"0",timestamp:parseInt(((new Date).getTime()+" ").substr(0,10)),key:(new Date).getTime(),read:0,platform:this.platform,transfer_account:0,payload:i+""},a=window.Base64.encode(JSON.stringify(n));return"contacts"!=t&&"pong"!=t&&"welcome"!=t&&"handshake"!=t&&"search_knowledge"!=t&&this.pushMessage(window.Base64.encode(a)),setTimeout((function(){s.user.sendMessage(e.toString(),a)}),150),n}Object(r["Toast"])({message:"服务异常，请刷新重试！"})},createLocalMessage:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n={from_account:parseInt(this.fetchMIMCTokenResult.data.appAccount),to_account:parseInt(e),biz_type:t,version:"0",platform:this.platform,timestamp:parseInt(((new Date).getTime()+" ").substr(0,10)),key:(new Date).getTime(),read:0,transfer_account:parseInt(i),payload:s+""};return n}}}}),j=I,_={months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY年MM月DD日",LLL:"YYYY年MM月DD日Ah点mm分",LLLL:"YYYY年MM月DD日ddddAh点mm分",l:"YYYY-M-D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(t,e){return 12===t&&(t=0),"凌晨"===e||"早上"===e||"上午"===e?t:"下午"===e||"晚上"===e?t+12:t>=11?t:t+12},meridiem:function(t,e){var s=100*t+e;return s<600?"凌晨":s<900?"早上":s<1130?"上午":s<1230?"中午":s<1800?"下午":"晚上"},calendar:{sameDay:"[今天]LT",nextDay:"[明天]LT",nextWeek:"[下]ddddLT",lastDay:"[昨天]LT",lastWeek:"[上]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(日|月|周)/,ordinal:function(t,e){switch(e){case"d":case"D":case"DDD":return t+"日";case"M":return t+"月";case"w":case"W":return t+"周";default:return t}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",ss:"%d秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"},week:{dow:1,doy:4}},A=s("c1df");A.locale("zh-cn",_),c.a.defaults.baseURL="/v1";var C={clickToCloseNonZoomable:!1,fullscreenEl:!1};i["default"].use(y.a,C),i["default"].use(M),i["default"].use(j),i["default"].use(l.a),i["default"].config.productionTip=!1,new i["default"]({render:function(t){return t(b)}}).$mount("#app")},"7faf":function(t,e,s){"use strict";var i=s("8fba"),n=s.n(i);n.a},"8fba":function(t,e,s){},bb7f:function(t,e){var s=["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘","😗","😙","😚","🙂","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🤧","😇","🤠","🤡","🤥","🤫","🤭","🧐","🤓","😈","👿","👹","👺","💀","👻","👽","🤖","💩","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🤲","👐","🙌","👏","🤝","👍","👎","👊","✊","🤛","🤜","🤞","✌️","🤟","🤘","👌","👈","👉","👆","👇","☝️","✋","🤚","🖐","🖖","👋","🤙","💪","🖕","✍️","🙏"];e.emojiData=s},bed0:function(t,e,s){t.exports=s.p+"img/photo_btn.c337b681.png"}});
//# sourceMappingURL=app.eab418bf.js.map
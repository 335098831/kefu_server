(function(e){function t(t){for(var i,o,c=t[0],r=t[1],l=t[2],d=0,h=[];d<c.length;d++)o=c[d],a[o]&&h.push(a[o][0]),a[o]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);u&&u(t);while(h.length)h.shift()();return n.push.apply(n,l||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],i=!0,c=1;c<s.length;c++){var r=s[c];0!==a[r]&&(i=!1)}i&&(n.splice(t--,1),e=o(o.s=s[0]))}return e}var i={},a={app:0},n=[];function o(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=i,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(s,i,function(t){return e[t]}.bind(null,i));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=r;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"21fb":function(e,t,s){e.exports=s.p+"img/expression.73c98a16.png"},"42e0":function(e,t){e.exports="data:image/png;base64,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"},4678:function(e,t,s){var i={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function a(e){var t=n(e);return s(t)}function n(e){var t=i[e];if(!(t+1)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return t}a.keys=function(){return Object.keys(i)},a.resolve=n,e.exports=a,a.id="4678"},"56d7":function(e,t,s){"use strict";s.r(t);s("cadf"),s("551c"),s("f751"),s("097d");var i=s("2b0e"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mini-im-container",class:{"mini-im-pc-container":!e.isMobile,"mini-im-container-no-pto":!e.isShowHeader}},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.isMobile&&e.isInputPongIng&&!e.isShowHeader,expression:"isMobile && (isInputPongIng && !isShowHeader)"}],staticClass:"input-ing"},[e._v(e._s(e.inputPongIngString))]),e.isShowHeader?i("mt-header",{attrs:{fixed:"",title:e.isInputPongIng?e.inputPongIngString:"在线客服"}},[i("div",{attrs:{slot:"left"},slot:"left"},[i("mt-button",{attrs:{icon:"back"},on:{click:e.back}})],1),i("mt-button",{attrs:{slot:"right"},on:{click:e.headRightBtn},slot:"right"},[e.isArtificial?i("span",[e._v("结束会话")]):i("img",{attrs:{title:"人工客服",src:"http://qiniu.cmp520.com/kefu_icon_2000.png",alt:""}})])],1):e._e(),e.isMobile?e._e():i("div",{staticClass:"mini-im-pc-header"},[e._m(0),i("span",{directives:[{name:"show",rawName:"v-show",value:e.isInputPongIng,expression:"isInputPongIng"}]},[e._v(e._s(e.inputPongIngString))]),i("div",{staticClass:"right"},[e.isArtificial?e._e():i("img",{attrs:{title:"人工客服",src:"http://qiniu.cmp520.com/kefu_icon_2000.png",alt:""},on:{click:e.headRightBtn}}),e.isArtificial?i("span",{on:{click:e.headRightBtn}},[e._v("结束会话")]):e._e(),i("div",{staticClass:"close-btn",on:{click:e.clickCloseWindow}},[e._v("ㄨ")])])]),i("div",{ref:"miniImBody",staticClass:"mini-im-body"},[i("ul",{staticClass:"mini-im-chat-list"},[e.isLoadMorLoading?i("li",{staticClass:"message-loading"},[i("mt-spinner",{attrs:{color:"#26a2ff",size:20,type:"triple-bounce"}})],1):e._e(),e._l(e.viewMessage,function(t,s){return i("li",{key:s},[t.isShowDate?[i("div",{staticClass:"mini-im-chat-item"},[i("div",{staticClass:"chat-content"},[i("div",{staticClass:"chat-body"},[[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[i("span",[e._v(e._s(e.$formatFromNowDate(t.timestamp,"YYYY年MM月DD日 HH:mm")))])])])]],2)])])]:e._e(),i("div",{staticClass:"mini-im-chat-item",class:{self:t.from_account==e.userInfo.id}},[e.isShowInfo(t.biz_type)?i("div",{staticClass:"chat-avatar"},[i("img",{attrs:{src:t.avatar}})]):e._e(),i("div",{staticClass:"chat-content"},[i("div",{staticClass:"chat-body"},[t.isShowCancel?[t.from_account==e.userInfo.id&&e.isShowInfo(t.biz_type)?i("span",{staticClass:"cancel-btn",on:{click:function(){return e.cancelMessage(t.key)}}},[e._v("撤回")]):e._e()]:e._e(),"text"==t.biz_type||"welcome"==t.biz_type?[i("div",{staticClass:"text"},[i("span",{domProps:{innerHTML:e._s(t.payload.replace(/\n/gi,"<br />"))}})])]:e._e(),"photo"==t.biz_type?[i("div",{staticClass:"photo"},[t.percent&&100!=t.percent?i("span",[e._v("上传中"+e._s(t.percent)+"%")]):e._e(),i("img",{attrs:{src:t.payload,preview:"1"}})])]:e._e(),"knowledge"==t.biz_type?[i("div",{staticClass:"knowledge"},[i("div",{staticClass:"title"},[e._v("以下是您关心的相关问题?")]),e._l(JSON.parse(t.payload),function(t,s){return i("a",{key:s,attrs:{href:"javascript:void(0);"},on:{click:function(){return e.sendKnowledgeMessage(t.title)}}},[i("span",[e._v("• "+e._s(t.title))])])}),i("a",{on:{click:e.headRightBtn}},[e._v("• 以上都不是?我要找人工")])],2)]:e._e(),"end"==t.biz_type?[e._m(1,!0)]:e._e(),"timeout"==t.biz_type?[e._m(2,!0)]:e._e(),"system"==t.biz_type?[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[i("span",{domProps:{innerHTML:e._s(t.payload)}})])])]:e._e(),"cancel"==t.biz_type?[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[t.from_account==e.userInfo.id?i("span",[e._v("您撤回了一条消息")]):i("span",[e._v("对方撤回了一条消息")])])])]:e._e(),"transfer"==t.biz_type?[i("div",{staticClass:"system"},[i("div",{staticClass:"content"},[i("span",[e._v("已为您转接"+e._s(t.transfer_account)+"号客服")])])])]:e._e()],2)])])],2)})],2),e.isNotNetWork?i("div",{staticClass:"no-network"},[i("img",{attrs:{src:s("42e0"),alt:""}}),i("span",[e._v("网络连接已断开，请重新加载尝试~")]),i("button",{on:{click:e.resetLoad}},[e._v("重新加载")])]):e._e()]),e.isLoading?i("div",{staticClass:"mini-im-loading"},[i("mt-spinner",{attrs:{type:"triple-bounce",color:"#26a2ff"}})],1):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showEmoji,expression:"showEmoji"}],staticClass:"mini-im-emoji"},[i("div",{staticClass:"mini-im-emoji-content"},e._l(e.emojis,function(t,s){return i("span",{key:s,on:{click:function(){return e.clickEmoji(t)}}},[e._v(e._s(t))])}),0)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.handshakeKeywordList.length>0,expression:"handshakeKeywordList.length > 0"}],staticClass:"mini-im-knowledge"},[i("div",{staticClass:"mask",on:{click:function(t){e.handshakeKeywordList=[]}}}),i("span",[e._v("以下是您关心的相关问题?")]),i("ul",e._l(e.handshakeKeywordList,function(t,s){return i("li",{key:s,staticClass:"sendKnowledgeMessage",attrs:{data:t.title},on:{click:function(s){!e.isIOS&&e.sendKnowledgeMessage(t.title)}}},[e._v("• "+e._s(t.title))])}),0)]),i("div",{staticClass:"mini-im-tabbar-input"},[i("span",{staticClass:"photo-btn"},[i("img",{attrs:{src:s("bed0"),alt:""}}),i("input",{attrs:{onClick:"this.value = null",type:"file",accept:"image/*"},on:{change:e.changeFile}})]),i("span",{staticClass:"expression-btn",on:{click:function(t){e.showEmoji=!e.showEmoji}}},[i("img",{attrs:{src:s("21fb"),alt:""}})]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.isMobile&&!e.isShowHeader,expression:"isMobile && !isShowHeader"}],staticClass:"serverci",class:{on:!e.isArtificial},on:{click:e.headRightBtn}},[e.isArtificial?i("span",[e._v("结束会话")]):i("img",{attrs:{title:"人工客服",src:"http://qiniu.cmp520.com/bfbfbf.png",alt:""}})]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.chatValue,expression:"chatValue"}],ref:"textarea",staticStyle:{"vertical-align":"top",outline:"none"},attrs:{maxlength:"200",placeholder:"请用一句话描述您的问题~"},domProps:{value:e.chatValue},on:{keyup:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.keyUpEvent(t)},function(t){return!t.type.indexOf("key")&&13!==t.keyCode&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.shiftKey?e.enterShift(t):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.enterSendMessage(t)}],submit:e.sendTextMessage,focus:e.chatInputFocus,blur:e.chatInputBlur,input:function(t){t.target.composing||(e.chatValue=t.target.value)}}}),i("button",{ref:"sendButton",staticClass:"mini-input-send",attrs:{type:"button"}},[e._v("发送")])])],1)},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"title"},[s("img",{attrs:{src:"http://qiniu.cmp520.com/kefu_icon_2000.png",alt:""}}),s("span",[e._v("在线客服")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"system"},[s("div",{staticClass:"content"},[s("span",[e._v("本次会话结束，感谢您的耐心与支持！")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"system"},[s("div",{staticClass:"content"},[s("span",[e._v("会话超时，系统结束了本次会话")])])])}],o=(s("7f7f"),s("28a5"),s("386d"),s("4917"),s("bc3a")),c=s.n(o),r=s("76a0"),l=s.n(r),u=s("cea2"),d=s("1fba"),h=s("bb7f"),m={name:"app",data:function(){return{messages:[],isLoading:!0,isNotNetWork:!1,userLocal:"",isFirstGetMessage:!0,platform:5,uid:null,chatValue:"",emojis:h.emojiData,showEmoji:!1,userInfo:{},userAccount:null,companyInfo:null,uploadToken:null,isArtificial:!1,artificialAccount:null,robotInfo:null,robotAccount:null,isLoadMorEnd:!1,isUserSendLongTimeSystemMessage:!1,isAdminSendLongTimeSystemMessage:!1,isInputPongIng:!1,isLoadMorLoading:!1,isSendPong:!1,qiniuObservable:null,inputPongIngString:"对方正在输入...",scroll:null,isShowHeader:!0,isMobile:!0,handshakeKeywordList:[],searchHandshakeTimer:null}},created:function(){this.getLocal(),this.run()},computed:{account:function(){return this.isArtificial?this.artificialAccount:this.robotAccount},isIOS:function(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},isSafari:function(){return navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1},isJudgeBigScreen:function(){return this.$judgeBigScreen()},viewMessage:function(){for(var e=this.messages,t=0;t<e.length;t++)0==t&&(e[t].isShowDate=!0),t<e.length-1&&(e[t+1].isShowDate=!1,e[t+1].timestamp-120>e[t].timestamp&&(e[t+1].isShowDate=!0));return e}},mounted:function(){var e=this,t=this.queryToJson(location.search);t&&t.c&&localStorage.clear();var s=this.queryToJson(localStorage.getItem("urlQuery"));s&&(t=Object.assign({},s,t),t.u=s.u),t&&("0"==t.h&&(this.isShowHeader=!1),"0"==t.m&&(this.isMobile=!1,this.isShowHeader=!1),t.u&&(this.userAccount=parseInt(t.u)),t.p&&(this.platform=parseInt(t.p)),t.uid&&(this.uid=parseInt(t.uid)),"0"==t.r?(this.isArtificial=!0,this.artificialAccount=parseInt(t.a)):this.robotAccount=parseInt(t.a));var i=localStorage.getItem("isArtificial_"+this.userAccount),a=localStorage.getItem("artificialAccount_"+this.userAccount);"true"==i&&(this.isArtificial=!0,this.artificialAccount=parseInt(a)),setTimeout(function(){e.isLoading=!1,e.scroll=new d["a"](e.$refs.miniImBody,{click:!0,tab:!0,scrollY:!0,scrollbar:!0,bounceTime:400,preventDefaultException:{className:/(^|\s)text(\s|$)/},mouseWheel:!0}),e.scroll.on("touchEnd",function(t){t.y>30&&e.loadMorData()}),e.addSendButtonTouchEventListener(),e.createLinkQuery(),e.scrollIntoBottom()},500),this.onCheckIsOutSession()},beforeDestroy:function(){this.toggleWindow(this.userAccount,0)},methods:{run:function(){var e=this;this.getAllhttp(),this.upLastActivity(),this.$mimcInstance.addEventListener("receiveP2PMsg",this.receiveP2PMsg),this.$mimcInstance.addEventListener("disconnect",function(){console.log("链接断开！"),e.isNotNetWork=!0}),this.$mimcInstance.addEventListener("statusChange",function(e,t,s,i){console.log("状态发生变化",e,t,s,i)}),this.$mimcInstance.addEventListener("serverAck",function(t,s,i,a){console.log("发送消息服务器ack",t,s,i,a),localStorage.setItem("userLastCallBackMessageTime_"+e.userAccount,Date.now()),e.isUserSendLongTimeSystemMessage=!1}),this.onCheckIsloogTimeNotCallBack()},getLocal:function(){var e=this,t="";c.a.get("https://restapi.amap.com/v3/ip?key="+t).then(function(t){t.data.province&&(console.log(t.data.province+t.data.city),e.userLocal=t.data.province+t.data.city)}).catch(function(e){console.error(e)})},initMimc:function(){var e=this,t=this.$mimcInstance,s=t.getLocalCacheUser(this.userAccount);this.userInfo=s;var i=this.userAccount?this.userAccount:s?s.id:0;t.init({type:0,address:this.userLocal,uid:this.uid,platform:this.platform,account_id:i},function(s){s?(e.userInfo=s,e.userAccount=s.id,e.cleanRead(s.id),e.toggleWindow(s.id,1),t.login(function(){setTimeout(function(){e.messages=e.getLocalMessages(),e.isLoading=!1,e.artificialAccount||(console.log("握手消息"),t.sendMessage("handshake",e.robotAccount,"")),e.scrollIntoBottom()},500)})):setTimeout(function(){return e.initMimc()},1e3)}),this.onServciceLastMessageTimeNotCallBack()},resetLoad:function(){window.location.reload()},enterShift:function(e){this.isMobile||"Enter"!=e.code&&(this.chatValue=this.chatValue+"\n")},addSendButtonTouchEventListener:function(){var e=this;this.isIOS?document.addEventListener("touchstart",function(t){"mini-input-send"==t.target.getAttribute("class")&&e.sendTextMessage(),"sendKnowledgeMessage"==t.target.getAttribute("class")&&(console.log("监听发送按钮触摸事件",t.target.getAttribute("data")),e.sendKnowledgeMessage(t.target.getAttribute("data")))},!1):this.$refs.sendButton.addEventListener("click",this.sendTextMessage,!1)},cleanRead:function(e){c.a.get("/public/clean_read/"+e)},toggleWindow:function(e,t){c.a.put("/public/window/"+e,{window:t})},queryToJson:function(e){if(!e||""==e)return null;var t=e.substr(1,e.length).split("&");if(!t)return null;for(var s={},i=0;i<t.length;i++){var a=t[i].split("=");s[a[0]]=a[1]}return s},back:function(){history.go(-1)},isShowInfo:function(e){return-1==["end","transfer","cancel","timeout","system"].indexOf(e)},upLastActivity:function(){var e=this;this.onCheckIsOutSession();var t=this.$mimcInstance.getLocalCacheUser(this.userAccount);t&&c.a.get("/public/activity/"+t.id),this.isArtificial&&localStorage.setItem("artificialTime_"+this.userAccount,Date.now()),setTimeout(function(){return e.upLastActivity()},6e4)},onCheckIsOutSession:function(){var e=localStorage.getItem("artificialTime_"+this.userAccount);e&&(e=parseInt(e),Date.now()>e+6e5&&(this.isArtificial=!1,this.artificialAccount=null))},loadMorData:function(){var e=this;this.isLoadMorLoading||this.isLoadMorEnd||(this.isLoadMorLoading=!0,setTimeout(function(){var t=e.getLocalMessages();0==t.length&&(e.isLoadMorEnd=!0),e.messages=t.concat(e.messages),e.isLoadMorLoading=!1},1e3))},localAdmin:function(e){var t=localStorage.getItem("admin_"+e);return t?JSON.parse(t):null},localRobot:function(e){var t=localStorage.getItem("robot_"+e);return t?JSON.parse(t):null},clickEmoji:function(e){this.showEmoji=!1,this.chatValue=this.chatValue+e,this.scrollIntoBottom()},changeFile:function(e){var t=e.target,s=new FileReader,i=t.files[0];s.readAsDataURL(i);var a,n=this,o=parseInt(1e4*Math.random()*(new Date).getTime())+i.name.substr(i.name.lastIndexOf("."));s.onload=function(){var e=function(){a.percent=0,n.qiniuObservable=null,n.removeMessage(n.userInfo.id,a.key),Object(r["Toast"])({message:"上传失败，请重新上传！"});var e=n.$mimcInstance,t=e.createLocalMessage("system",n.account,"您刚刚上传的图片失败了，请重新上传！");n.messages.push(n.handlerMessage(t)),n.scrollIntoBottom()},t=function(e){n.qiniuObservable=null,a.percent=100;var t=n.uploadToken.host+"/"+e;n.$mimcInstance.sendMessage("photo",n.account,t)};a=n.$mimcInstance.createLocalMessage("photo",n.account,this.result),a["percent"]=0,a.isShowCancel=!0,setTimeout(function(){a.isShowCancel=!1},1e4),n.messages.push(n.handlerMessage(a));var s=Object.assign({},a);if(s.payload=n.uploadToken.host+"/"+o,n.messagesPushMemoryAndLocalStoreSave(s,!1),n.$previewRefresh(),n.scrollIntoBottom(),1==n.uploadToken.mode){var l=new FormData;l.append("file",i),l.append("file_name",o),c.a.post("/public/upload",l).then(function(e){t(e.data.data)}).catch(function(){e()})}else if(2==n.uploadToken.mode){var d={quality:.92,noCompressIfLarger:!0,maxWidth:1500};u["compressImage"](i,d).then(function(s){var i=u["upload"](s.dist,o,n.uploadToken.secret,{},{mimeType:null});n.qiniuObservable=i.subscribe({next:function(e){a.percent=Math.ceil(e.total.percent),e.total.size<1&&(n.qiniuObservable.unsubscribe(),n.cancelMessage(a.key),Object(r["Toast"])({message:"上传失败，该图片已损坏！"}))},error:function(){e()},complete:function(e){t(e.key)}})})}}},scrollIntoBottom:function(){var e=this;setTimeout(function(){var t=e.$refs.miniImBody.querySelectorAll("li");e.scroll&&e.scroll.scrollToElement(t[t.length-1])},50)},chatInputFocus:function(){this.scrollIntoBottom(),this.showEmoji=!1},chatInputBlur:function(){window.chatInputInterval=null,window.scroll(0,0)},getRobot:function(){var e=this;return c.a.get("/public/robot/1").then(function(t){var s=t.data.data;localStorage.setItem("robot_"+s.id,JSON.stringify(s)),e.robotAccount=s.id,e.robotInfo=s}).catch(function(e){Object(r["Toast"])({message:e.response.data.message})})},getUploadSecret:function(){var e=this;return c.a.get("/public/secret").then(function(t){e.uploadToken=t.data.data})},getCompanyInfo:function(){var e=this;return c.a.get("/public/company").then(function(t){e.companyInfo=t.data.data}).catch(function(e){Object(r["Toast"])({message:e.response.data.message})})},getAllhttp:function(){var e=this;c.a.all([this.getRobot(),this.getCompanyInfo(),this.getUploadSecret()]).then(c.a.spread(function(){e.initMimc()})).catch(function(){return setTimeout(function(){return e.getAllhttp()},1e3)})},receiveP2PMsg:function(e){if("transfer"==e.biz_type){this.isArtificial=!0,this.artificialAccount=e.transfer_account;var t=this.$mimcInstance;t.sendMessage("handshake",e.transfer_account,"");var s=JSON.parse(e.payload);localStorage.setItem("admin_"+s.id,JSON.stringify(s)),localStorage.setItem("adminLastCallBackMessageTime_"+s.id,Date.now()),this.isAdminSendLongTimeSystemMessage=!1}if(!this.isArtificial||"text"!=e.biz_type&&"photo"!=e.biz_type&&"cancel"!=e.biz_type||(localStorage.setItem("adminLastCallBackMessageTime_"+this.account,Date.now()),this.isAdminSendLongTimeSystemMessage=!1),"cancel"==e.biz_type&&this.removeMessage(e.from_account,e.payload),"end"!=e.biz_type&&"timeout"!=e.biz_type||(this.isArtificial=!1,this.artificialAccount=null),"pong"!=e.biz_type){if("search_knowledge"==e.biz_type)return this.handshakeKeywordList=[],void(""!=e.payload&&(this.handshakeKeywordList=JSON.parse(e.payload)));this.messagesPushMemoryAndLocalStoreSave(e),this.scrollIntoBottom(),this.$previewRefresh(),window.parent.postMessage({newMessage:1},"*");try{"transfer"==e.biz_type&&(e.payload="客服转接"),"cancel"==e.biz_type&&(e.payload="对方撤回了一条消息"),"end"!=e.biz_type&&"timeout"!=e.biz_type||(e.payload="会话超时")}catch(i){console.log(i)}}else this.inputPongIng()},inputPongIng:function(){var e=this;this.isInputPongIng||(this.isInputPongIng=!0,setTimeout(function(){e.inputPongIngString="对方正在输入."},500),setTimeout(function(){e.inputPongIngString="对方正在输入.."},1500),setTimeout(function(){e.inputPongIngString="对方正在输入...",e.isInputPongIng=!1},3e3))},enterSendMessage:function(){this.isMobile||(this.sendTextMessage(),this.$refs.textarea.focus())},sendTextMessage:function(){if(0!=this.userInfo.online){var e=this.chatValue.trim();if(""!=e){var t=this.$mimcInstance,s=t.sendMessage("text",this.account,e);s.isShowCancel=!0,setTimeout(function(){return s.isShowCancel=!1},1e4),this.messagesPushMemoryAndLocalStoreSave(s),this.chatValue="",this.handshakeKeywordList=[]}}else Object(r["Toast"])({message:"您貌似掉线了"})},cancelMessage:function(e){var t=this.$mimcInstance,s=t.sendMessage("cancel",this.account,e);this.messagesPushMemoryAndLocalStoreSave(s),this.removeMessage(this.userInfo.id,e),this.qiniuObservable&&this.qiniuObservable.unsubscribe()},sendKnowledgeMessage:function(e){this.handshakeKeywordList=[];var t=this.$mimcInstance,s=t.sendMessage("text",this.account,e);this.messagesPushMemoryAndLocalStoreSave(s),this.chatValue=""},headRightBtn:function(){var e=this;if(!window.isClickHeadRightBtn){window.isClickHeadRightBtn=!0;var t=this.$mimcInstance;if(this.isArtificial)return r["MessageBox"].confirm("您确定关闭此次会话吗?","温馨提示! ").then(function(){var s=t.sendMessage("end",e.account,"");e.messagesPushMemoryAndLocalStoreSave(s),e.isArtificial=!1,e.artificialAccount=null}),void setTimeout(function(){return window.isClickHeadRightBtn=!1},3e3);var s=t.sendMessage("text",this.account,"人工");this.messagesPushMemoryAndLocalStoreSave(s),setTimeout(function(){return window.isClickHeadRightBtn=!1},3e3)}},messagesPushMemoryAndLocalStoreSave:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("pong"!=e.biz_type&&"handshake"!=e.biz_type&&"into"!=e.biz_type&&(t&&this.messages.push(this.handlerMessage(e)),"welcome"!=e.biz_type)){var s=[],i=localStorage.getItem("miniImAppMessageRecord_"+this.userInfo.id);i&&(s=JSON.parse(i)),s.push(this.handlerMessage(e)),localStorage.setItem("miniImAppMessageRecord_"+this.userInfo.id,JSON.stringify(s)),this.scrollIntoBottom()}},handlerMessage:function(e){var t="data:image/png;base64,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",s=this.localAdmin(e.from_account),i=this.localRobot(e.from_account);return s&&e.from_account==s.id?(e.nickname=s.nickname,e.avatar=""==s.avatar?t:s.avatar):i&&e.from_account==i.id?(e.nickname=i.nickname,e.avatar=""==i.avatar?t:i.avatar):e.from_account==this.userInfo.id&&(e.nickname=this.userInfo.nickname,-1!=this.userInfo.nickname.indexOf(this.userInfo.id)&&(e.nickname="我"),e.avatar=""==this.userInfo.avatar?t:this.userInfo.avatar),e},getLocalMessages:function(){var e=15,t=[],s=localStorage.getItem("miniImAppMessageRecord_"+this.userInfo.id);if(s){var i=JSON.parse(s);if(this.isFirstGetMessage)this.isFirstGetMessage=!1,t=i.slice(-e,i.length);else{for(var a=-1,n=i.length-1;n>=0;n--)if(i[n].timestamp==this.messages[0].timestamp){a=n;break}if(-1==a)return[];t=i.slice(-(i.length-a+e),a)}}for(var o=0;o<t.length;o++){var c=t[o];c.isShowCancel=!1,t[o]=this.handlerMessage(c)}return t},keyUpEvent:function(){var e=this;this.isArtificial&&(this.isSendPong||(this.isSendPong=!0,setTimeout(function(){return e.isSendPong=!1},100),this.$mimcInstance.sendMessage("pong",this.account,this.chatValue)))},removeMessage:function(e,t){for(var s=[],i=0;i<this.messages.length;i++)this.messages[i].key==t&&this.messages[i].from_account==e||s.push(this.messages[i]);var a=localStorage.getItem("miniImAppMessageRecord_"+this.userInfo.id);if(a){for(var n=JSON.parse(a),o=[],c=0;c<n.length;c++){var r=n[c];r.key==t&&r.from_account==e||"welcome"!=r.biz_type&&"handshake"!=r.biz_type&&"into"!=r.biz_type&&o.push(n[c])}localStorage.setItem("miniImAppMessageRecord_"+this.userInfo.id,JSON.stringify(o))}this.messages=s},createLinkQuery:function(){var e=this.isArtificial?0:1,t=0==e?this.artificialAccount:this.robotAccount,s=this.isMobile?1:0,i=this.isShowHeader?1:0,a=this.platform?this.platform:1,n=this.userAccount?"&u="+this.userAccount:"",o=this.uid?"&uid="+this.uid:"",c="?h="+i+"&m="+s+"&p="+a+"&r="+e+"&a="+t+n+o;history.replaceState(null,null,c),null!=this.userAccount&&"null"!=this.userAccount&&""!=this.userAccount&&localStorage.setItem("urlQuery",c)},clickCloseWindow:function(){window.parent.postMessage({clickCloseWindow:!0},"*")},onCheckIsloogTimeNotCallBack:function(){var e=this,t=localStorage.getItem("userLastCallBackMessageTime_"+this.userAccount)||Date.now();if(this.isArtificial&&!this.isUserSendLongTimeSystemMessage&&Date.now()-t>=3e5){var s=this.$mimcInstance,i=s.createLocalMessage("system",this.account,"您已超过5分钟未回复消息，系统3分钟后将结束对话");this.messages.push(this.handlerMessage(i)),this.isUserSendLongTimeSystemMessage=!0,this.scrollIntoBottom()}setTimeout(function(){return e.onCheckIsloogTimeNotCallBack()},1e4)},onServciceLastMessageTimeNotCallBack:function(){var e=this;if(this.robotInfo){var t=this.robotInfo.loog_time_wait_text,s=localStorage.getItem("adminLastCallBackMessageTime_"+this.account)||Date.now();if(this.isArtificial&&!this.isAdminSendLongTimeSystemMessage&&""!=t.trim()&&Date.now()-s>=12e4){var i=this.$mimcInstance,a=i.createLocalMessage("text",this.account,t);a.from_account=this.robotAccount,this.messages.push(this.handlerMessage(a)),this.isAdminSendLongTimeSystemMessage=!0,this.scrollIntoBottom()}setTimeout(function(){return e.onServciceLastMessageTimeNotCallBack()},1e4)}},onSearchHandshake:function(){var e=this;if(this.chatValue&&!this.isArtificial){this.searchHandshakeTimer&&clearTimeout(this.searchHandshakeTimer);var t=this.$mimcInstance;this.searchHandshakeTimer=setTimeout(function(){t.sendMessage("search_knowledge",e.robotAccount,e.chatValue),e.searchHandshakeTimer=null},500)}else this.handshakeKeywordList=[]}},watch:{messages:function(){var e=this;setTimeout(function(){e.scroll&&e.scroll.refresh(),e.$previewRefresh()},50)},isArtificial:function(e){this.createLinkQuery(),localStorage.setItem("isArtificial_"+this.userAccount,e),localStorage.setItem("artificialTime_"+this.userAccount,Date.now()),e||localStorage.removeItem("artificialTime_"+this.userAccount)},artificialAccount:function(){localStorage.setItem("artificialAccount_"+this.userAccount,this.artificialAccount)},userInfo:function(){this.createLinkQuery()},chatValue:function(){this.onSearchHandshake()}}},f=m,g=(s("7faf"),s("2877")),p=Object(g["a"])(f,a,n,!1,null,null,null),b=p.exports,v=s("d1d4"),A=s.n(v),y=(s("394c"),s("aa35"),s("c1df")),k={install:function(e,t){e.prototype.$myMethod=function(){console.log(t)},e.prototype.$formatUnixDate=function(e,t){return y(parseInt(e+"000")).format(t)},e.prototype.$formatFromNowDate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm";return y().format("YYYYMMDD")==y(parseInt(e+"000")).format("YYYYMMDD")?"今天 "+y(parseInt(e+"000")).format("HH:mm"):y(parseInt(e+"000")).format(t)},e.prototype.$robotNickname=function(e){for(var t,s=this.$store.getters.robots,i=0;i<s.length;i++)s[i].id==e&&(t=s[i].nickname);return t},e.prototype.$judgeBigScreen=function(){var e=!1,t=window.screen.height/window.screen.width,s=window.screen.height==window.screen.availHeight?1.8:1.65;return t>s&&(e=!0),e}}},w=k,I=(s("6b54"),{install:function(e,t){console.log(t),e.MimcInstance=e.prototype.$mimcInstance={user:null,robot:null,platform:5,fetchMIMCTokenResult:null,_receiveP2PMsgCallback:null,_statusChangeCallback:null,_serverAckCallback:null,_disconnectCallback:null,init:function(e,t){this.platform=e.platform,this.fetchMIMCToken(e,t),this.getRobot()},getLocalCacheUser:function(e){var t=localStorage.getItem("miniImAppUser_"+e);return t?JSON.parse(t):null},fetchMIMCToken:function(e,t){var s=this;c.a.post("/public/register",e).then(function(e){s.fetchMIMCTokenResult=e.data.data.token,localStorage.setItem("miniImAppUser_"+e.data.data.user.id,JSON.stringify(e.data.data.user)),console.log("MIMC初始化成功"),t&&t(e.data.data.user)}).catch(function(e){t&&t(null),console.log(e.response),Object(r["Toast"])({message:e.response.data.message})})},getRobot:function(){var e=this;c.a.get("/public/robot/1").then(function(t){e.robot=t.data.data}).catch(function(e){Object(r["Toast"])({message:"mimc初始化失败,请刷新重试"+e.response.data.message})})},login:function(e){var t=this;try{if(this.user)return;var s=this.fetchMIMCTokenResult;this.user=new MIMCUser(s.data.appId,s.data.appAccount,"666"),this.user.registerP2PMsgHandler(function(e){var s=JSON.parse(window.Base64.decode(e.getPayload()));t._receiveP2PMsgCallback&&t._receiveP2PMsgCallback(s)}),this.user.registerFetchToken(function(){return s}),this.user.registerStatusChange(function(e,s,i,a){t._statusChangeCallback&&t._statusChangeCallback(e,s,i,a)}),this.user.registerServerAckHandler(function(e,s,i,a){t._serverAckCallback&&t._serverAckCallback(e,s,i,a)}),this.user.registerDisconnHandler(function(){t._disconnectCallback&&t._disconnectCallback()}),this.user.login(),window.mimcInstance=this,e&&e(),console.log("MIMC登录成功")}catch(i){console.log("MIMC登录失败"),setTimeout(function(){t.login()},1e3)}},logout:function(){this.user&&(this.user.logout(),this.user=null)},addEventListener:function(e,t){switch(e){case"receiveP2PMsg":this._receiveP2PMsgCallback=t;break;case"statusChange":this._statusChangeCallback=t;break;case"serverAck":this._serverAckCallback=t;break;case"disconnect":this._disconnectCallback=t;break}},sendMessage:function(e,t){var s=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.user){var a={from_account:parseInt(this.fetchMIMCTokenResult.data.appAccount),to_account:parseInt(t),biz_type:e,version:"0",timestamp:parseInt(((new Date).getTime()+" ").substr(0,10)),key:(new Date).getTime(),read:0,platform:this.platform,transfer_account:0,payload:i+""},n=window.Base64.encode(JSON.stringify(a));if("contacts"!=e&&"pong"!=e&&"welcome"!=e&&"handshake"!=e&&"search_knowledge"!=e){var o={biz_type:"into",payload:n},c=window.Base64.encode(JSON.stringify(o));this.user.sendMessage(this.robot.id.toString(),c)}return setTimeout(function(){s.user.sendMessage(t.toString(),n)},150),a}Object(r["Toast"])({message:"服务异常，请刷新重试！"})},createLocalMessage:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={from_account:parseInt(this.fetchMIMCTokenResult.data.appAccount),to_account:parseInt(t),biz_type:e,version:"0",platform:this.platform,timestamp:parseInt(((new Date).getTime()+" ").substr(0,10)),key:(new Date).getTime(),read:0,transfer_account:parseInt(i),payload:s+""};return a}}}}),M=I,j={months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY年MM月DD日",LLL:"YYYY年MM月DD日Ah点mm分",LLLL:"YYYY年MM月DD日ddddAh点mm分",l:"YYYY-M-D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"下午"===t||"晚上"===t?e+12:e>=11?e:e+12},meridiem:function(e,t){var s=100*e+t;return s<600?"凌晨":s<900?"早上":s<1130?"上午":s<1230?"中午":s<1800?"下午":"晚上"},calendar:{sameDay:"[今天]LT",nextDay:"[明天]LT",nextWeek:"[下]ddddLT",lastDay:"[昨天]LT",lastWeek:"[上]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(日|月|周)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",ss:"%d秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"},week:{dow:1,doy:4}},C=s("c1df");C.locale("zh-cn",j),c.a.defaults.baseURL="http://kf.aissz.com:666/v1";var S={clickToCloseNonZoomable:!1,fullscreenEl:!1};i["default"].use(A.a,S),i["default"].use(w),i["default"].use(M),i["default"].use(l.a),i["default"].config.productionTip=!1,new i["default"]({render:function(e){return e(b)}}).$mount("#app")},"7faf":function(e,t,s){"use strict";var i=s("8fba"),a=s.n(i);a.a},"8fba":function(e,t,s){},bb7f:function(e,t){var s=["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘","😗","😙","😚","🙂","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🤧","😇","🤠","🤡","🤥","🤫","🤭","🧐","🤓","😈","👿","👹","👺","💀","👻","👽","🤖","💩","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🤲","👐","🙌","👏","🤝","👍","👎","👊","✊","🤛","🤜","🤞","✌️","🤟","🤘","👌","👈","👉","👆","👇","☝️","✋","🤚","🖐","🖖","👋","🤙","💪","🖕","✍️","🙏"];t.emojiData=s},bed0:function(e,t,s){e.exports=s.p+"img/photo_btn.c337b681.png"}});
//# sourceMappingURL=app.0d81bffb.js.map
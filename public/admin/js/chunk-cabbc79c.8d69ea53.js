(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cabbc79c"],{"11e9":function(t,e,a){var s=a("52a7"),n=a("4630"),o=a("6821"),i=a("6a99"),r=a("69a8"),c=a("c69a"),l=Object.getOwnPropertyDescriptor;e.f=a("9e1e")?l:function(t,e){if(t=o(t),e=i(e,!0),c)try{return l(t,e)}catch(a){}if(r(t,e))return n(!s.f.call(t,e),t[e])}},"1c01":function(t,e,a){var s=a("5ca1");s(s.S+s.F*!a("9e1e"),"Object",{defineProperty:a("86cc").f})},2725:function(t,e,a){},"454f":function(t,e,a){a("46a7");var s=a("584a").Object;t.exports=function(t,e,a){return s.defineProperty(t,e,a)}},"456d":function(t,e,a){var s=a("4bf8"),n=a("0d58");a("5eda")("keys",(function(){return function(t){return n(s(t))}}))},"46a7":function(t,e,a){var s=a("63b6");s(s.S+s.F*!a("8e60"),"Object",{defineProperty:a("d9f6").f})},"4f37":function(t,e,a){"use strict";a("aa77")("trim",(function(t){return function(){return t(this,3)}}))},"58b2":function(t,e,a){var s=a("5ca1");s(s.S+s.F*!a("9e1e"),"Object",{defineProperties:a("1495")})},"5eda":function(t,e,a){var s=a("5ca1"),n=a("8378"),o=a("79e5");t.exports=function(t,e){var a=(n.Object||{})[t]||Object[t],i={};i[t]=e(a),s(s.S+s.F*o((function(){a(1)})),"Object",i)}},7563:function(t,e,a){"use strict";var s=a("2725"),n=a.n(s);n.a},"7b0d":function(t,e,a){"use strict";var s=a("eb66"),n=a.n(s);n.a},"85f2":function(t,e,a){t.exports=a("454f")},"8e6e":function(t,e,a){var s=a("5ca1"),n=a("990b"),o=a("6821"),i=a("11e9"),r=a("f1ae");s(s.S,"Object",{getOwnPropertyDescriptors:function(t){var e,a,s=o(t),c=i.f,l=n(s),u={},d=0;while(l.length>d)a=c(s,e=l[d++]),void 0!==a&&r(u,e,a);return u}})},9093:function(t,e,a){var s=a("ce10"),n=a("e11e").concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,n)}},"990b":function(t,e,a){var s=a("9093"),n=a("2621"),o=a("cb7c"),i=a("7726").Reflect;t.exports=i&&i.ownKeys||function(t){var e=s.f(o(t)),a=n.f;return a?e.concat(a(t)):e}},aa77:function(t,e,a){var s=a("5ca1"),n=a("be13"),o=a("79e5"),i=a("fdef"),r="["+i+"]",c="​",l=RegExp("^"+r+r+"*"),u=RegExp(r+r+"*$"),d=function(t,e,a){var n={},r=o((function(){return!!i[t]()||c[t]()!=c})),l=n[t]=r?e(p):i[t];a&&(n[a]=l),s(s.P+s.F*r,"String",n)},p=d.trim=function(t,e){return t=String(n(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=d},ac6a:function(t,e,a){for(var s=a("cadf"),n=a("0d58"),o=a("2aba"),i=a("7726"),r=a("32e9"),c=a("84f2"),l=a("2b4c"),u=l("iterator"),d=l("toStringTag"),p=c.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},h=n(f),v=0;v<h.length;v++){var m,g=h[v],w=f[g],b=i[g],_=b&&b.prototype;if(_&&(_[u]||r(_,u,p),_[d]||r(_,d,g),c[g]=p,w))for(m in s)_[m]||o(_,m,s[m],!0)}},bd86:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));var s=a("85f2"),n=a.n(s);function o(t,e,a){return e in t?n()(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},d25f:function(t,e,a){"use strict";var s=a("5ca1"),n=a("0a49")(2);s(s.P+s.F*!a("2f21")([].filter,!0),"Array",{filter:function(t){return n(this,t,arguments[1])}})},df5f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"me-head"},[a("span",[a("i",{staticClass:"el-icon-tickets"}),a("span",{attrs:{slot:"title"},slot:"title"},[t._v("工单管理")]),t._m(0)]),a("div",[a("el-button",{attrs:{size:"mini"}},[t._v("分类设置")])],1)]),a("el-divider"),a("div",{staticClass:"container-box"},[a("div",{staticClass:"menu"},[a("el-tabs",{staticStyle:{width:"200px",height:"80vh"},attrs:{"tab-position":"left"},on:{"tab-click":t.tabsChange}},[t._l(t.workorderTypes,(function(t){return[a("el-tab-pane",{key:t.id,attrs:{label:t.title+"（"+t.count+"）"}})]}))],2)],1),a("div",{staticClass:"table-content"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData.list}},[a("el-table-column",{attrs:{type:"index",index:t.indexMethod,width:"60",label:"#序号"}}),a("el-table-column",{attrs:{prop:"title",label:"工单标题"}}),a("el-table-column",{attrs:{prop:"status",label:"当前状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?a("el-tag",{attrs:{type:"warning"}},[t._v("等待客服处理")]):t._e(),2==e.row.status?a("el-tag",{attrs:{type:"warning"}},[t._v("等待客服回复")]):t._e(),1==e.row.status?a("el-tag",{attrs:{type:"success"}},[t._v("已有客服回复")]):t._e(),3==e.row.status?a("el-tag",{attrs:{type:"info"}},[t._v(" 工单已结束 ")]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"u_nickname",label:"用户（发布者）"}}),a("el-table-column",{attrs:{prop:"a_nickname",label:"最后回复者（客服）"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.a_nickname||"-----")+"\n        ")]}}])}),a("el-table-column",{attrs:{prop:"create_at",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.$formatUnixDate(e.row.create_at,"YYYY/MM/DD")))]}}])}),a("el-table-column",{attrs:{prop:"operating",align:"center",width:"150",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.onShow(e.row)}}},[t._v("查 看")])]}}])})],1),a("el-row",{staticStyle:{"margin-top":"20px"},attrs:{type:"flex",justify:"space-between"}},[a("span",{staticStyle:{color:"#666","font-size":"14px"}},[t._v("共找到"+t._s(t.tableData.total)+"条数据")]),a("el-pagination",{attrs:{background:"",layout:"sizes, prev, pager, next","current-page":t.tableData.page_on,"page-sizes":[5,10,15,20],total:t.tableData.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)]),a("WorkOrderView",{attrs:{workorderTypes:t.workorderTypes,prop:t.showWorkOrder},model:{value:t.isShowWorkOrderView,callback:function(e){t.isShowWorkOrderView=e},expression:"isShowWorkOrderView"}})],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",{staticStyle:{"font-size":"15px","margin-left":"30px",color:"#e7a646"}},[t._v("当前有\n         "),a("strong",{staticStyle:{color:"#f56c6c"}},[t._v("5")]),t._v("\n          条待处理, 和"),a("strong",{staticStyle:{color:"#f56c6c"}},[t._v(" 8")]),t._v("\n           条待回复工单")])}],o=a("bc3a"),i=a.n(o),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.value,expression:"value"}],staticClass:"workorder-view",class:{"is-show-aside":!t.isShowAside}},[a("div",{staticClass:"mask",on:{dblclick:t.close}}),a("transition",{attrs:{name:"el-zoom-in-bottom"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.value,expression:"value"}],staticClass:"content-box",class:{"padding-bottom30":3==t.showData.status}},[a("div",{staticClass:"title"},[a("i",{staticClass:"el-icon-tickets"}),t._v(" 工单详细\n      ")]),a("div",{staticClass:"buttons"},[1!=t.showData.status&&2!=t.showData.status||0!=t.showData.delete?t._e():a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:t.closeWorkorder}},[t._v("关闭工单")]),3==t.showData.status&&1==t.adminInfo.root&&0==t.showData.delete?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:t.delWorkorder}},[t._v("删除工单")]):t._e(),1==t.showData.delete?a("div",{staticStyle:{"font-size":"13px","margin-top":"5px",color:"#f44336"}},[t._v("该工单已删除")]):t._e()],1),a("span",{staticClass:"close",on:{click:t.close}},[a("i",{staticClass:"el-icon-close"})]),a("div",{staticClass:"content"},[a("div",{staticClass:"scroll"},[a("div",{staticClass:"form-line"},[a("span",{staticClass:"lable"},[t._v("标题：")]),a("div",{staticClass:"con"},[t._v(t._s(t.showData.title))])]),a("div",{staticClass:"form-line"},[a("span",{staticClass:"lable"},[t._v("用户：")]),a("div",{staticClass:"con"},[t._v(t._s(t.showData.u_nickname))])]),a("div",{staticClass:"form-line"},[a("span",{staticClass:"lable"},[t._v("手机：")]),a("div",{staticClass:"con"},[t._v(t._s(t.showData.phone))])]),a("div",{staticClass:"form-line"},[a("span",{staticClass:"lable"},[t._v("邮箱：")]),a("div",{staticClass:"con"},[t._v(t._s(t.showData.email||"未预留邮箱"))])]),a("div",{staticClass:"form-line"},[a("span",{staticClass:"lable"},[t._v("类型：")]),a("div",{staticClass:"con"},[t._v(t._s(t.typeName||"---"))])]),a("div",{staticClass:"form-line"},[a("span",{staticClass:"lable"},[t._v("状态：")]),a("div",{staticClass:"con"},[0==t.showData.status?a("span",{staticStyle:{color:"#e6a23c"}},[t._v("等待客服处理")]):t._e(),2==t.showData.status?a("span",{staticStyle:{color:"#e6a23c"}},[t._v("等待客服回复")]):t._e(),1==t.showData.status?a("span",{staticStyle:{color:"#67c23a"}},[t._v("已有客服回复")]):t._e(),3==t.showData.status?a("span",{staticStyle:{color:"#909399"}},[t._v("工单已结束")]):t._e()])]),a("div",{staticClass:"form-line"},[a("span",{staticClass:"lable"},[t._v("内容：")]),a("div",{staticClass:"con",domProps:{innerHTML:t._s(t.showData.content)}})]),a("el-divider",{staticStyle:{height:"10px"}}),a("div",{staticClass:"comments"},[t.comments.length<=0&&!t.isShowGetCommentsLoading?a("div",{staticClass:"no-data"},[t._v("暂无回复内容~")]):t._e(),t.isShowGetCommentsLoading?a("div",{staticClass:"comments-loading"},[a("i",{staticClass:"el-icon-loading"}),a("span",[t._v("正在努力加载中~")])]):t._l(t.comments,(function(e,s){return[a("div",{key:s,staticClass:"item"},[a("div",{staticClass:"avatar"},[e.aid==t.adminInfo.id?a("img",{attrs:{src:t.adminInfo.avatar||"http://qiniu.cmp520.com/avatar_degault_3.png",alt:""}}):a("img",{attrs:{src:e.a_avatar||"http://qiniu.cmp520.com/avatar_degault_3.png",alt:""}})]),a("div",{staticClass:"right"},[0==e.aid?a("div",{staticClass:"nickname"},[t._v(t._s(e.u_nickname))]):a("div",{staticClass:"nickname"},[t._v(t._s(e.a_nickname))]),a("div",{staticClass:"detail",domProps:{innerHTML:t._s(e.content)}}),a("div",{staticClass:"date"},[t._v(t._s(t.$formatDate(e.create_at)))])])])]})),t.showData&&3==t.showData.status?a("div",{staticClass:"workorder-close"},[t._v("工单已结束~")]):t._e()],2)],1)]),""!=t.request.source||t.isShowUploadLoading?a("div",{staticClass:"file-view"},[t.isShowUploadLoading?a("span",[a("i",{staticClass:"el-icon-loading"}),a("i",[t._v("上传中~")])]):a("span",[a("i",{staticClass:"el-icon-paperclip"}),a("i",[t._v("你已成功添加附件，重新上传可替换~")])])]):t._e(),3!=t.showData.status?a("div",{staticClass:"input-form"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.request.content,expression:"request.content"}],attrs:{placeholder:"请输入内容~"},domProps:{value:t.request.content},on:{blur:function(e){return t.inputBlur()},input:function(e){e.target.composing||t.$set(t.request,"content",e.target.value)}}}),a("span",{staticClass:"icon-btn"},[a("input",{attrs:{title:"添加附件",type:"file",onclick:"this.value = null"},on:{change:t.uploadFile}})]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.reply()}}},[t._v("提交")])],1):t._e()])])],1)},c=[],l=(a("1c01"),a("58b2"),a("8e6e"),a("f3e2"),a("ac6a"),a("456d"),a("57e7"),a("9865"),a("4f37"),a("d25f"),a("bd86")),u=a("2f62"),d=a("fb21");function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach((function(e){Object(l["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var h={name:"workorder-view",data:function(){return{isShowUploadLoading:!1,isShowGetCommentsLoading:!1,isSubmit:!1,workorder:null,comments:[],fileType:"",request:{source:"",content:""}}},props:{value:{default:!1,type:Boolean},prop:Object,workorderTypes:Array},created:function(){this.comments=[]},computed:f({showData:function(){return this.workorder||this.prop},isShowAside:function(){return this.$store.state.isShowAside},typeName:function(){var t=this;try{return this.workorderTypes.filter((function(e){return e.id==t.showData.tid}))[0].title}catch(e){return""}}},Object(u["b"])(["adminInfo","uploadToken"])),methods:{close:function(){this.$emit("input",!1)},getWorkOrder:function(){var t=this;i.a.get("/public/workorder/"+this.prop.id).then((function(e){null!=e.data.data&&(t.workorder=e.data.data),setTimeout((function(){return t.$previewRefresh()}),500)}))},getComments:function(){var t=this;this.isShowGetCommentsLoading=!0,i.a.get("/public/workorder/comments/"+this.prop.id).then((function(e){null!=e.data.data&&(t.comments=e.data.data),setTimeout((function(){return t.$previewRefresh()}),500),t.isShowGetCommentsLoading=!1})).catch((function(e){console.log(e),t.isShowGetCommentsLoading=!1,t.$message.error("加载失败，请刷新尝试~")}))},closeWorkorder:function(){var t=this;this.$prompt("请输入关闭原因！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"关闭工单原因不能为空~"}).then((function(e){var a=e.value,s=t.showData.id,n=a;i.a.post("/workorder/close",{wid:s,remark:n}).then((function(){t.getWorkOrder(),t.$notify({title:"温馨提示！",message:"工单已关闭~",showClose:!1,type:"success"})})).catch((function(){t.$message.error("工单关闭失败~")}))}))},delWorkorder:function(){var t=this;this.$confirm("您确定删除该工单吗?","温馨提示！",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e=t.showData.id;i.a.delete("/public/workorder/"+e).then((function(){t.$notify({title:"温馨提示！",message:"工单已删除~",showClose:!1,type:"success"}),t.close()})).catch((function(){t.$message.error("工单删除失败~")}))}))},reply:function(){var t=this,e=this.request.content+this.request.source;if(""!=e.trim()){if(!this.isSubmit){this.isSubmit=!0;var a=this.showData.id;i.a.post("/public/workorder/reply",{wid:a,content:e}).then((function(e){t.isSubmit=!1,console.log(e),t.getComments(),t.request={source:"",content:""},t.$notify({title:"温馨提示！",message:"回复成功~",showClose:!1,type:"success"}),setTimeout((function(){var t=document.querySelector(".content").clientHeight,e=document.querySelector(".scroll").clientHeight;document.querySelector(".content").scrollTop=e-t+20}),500)})).catch((function(e){t.isSubmit=!1,console.log(e),t.$message.error("提交失败~")}))}}else this.$message.error("请输入内容~")},inputBlur:function(){setTimeout((function(){document.body.scrollTo=0,window.scrollTo(0,0)}),100)},uploadFile:function(t){var e=t.target,a=e.files[0];this.isShowUploadLoading=!0;var s=this;Object(d["a"])({file:a,mode:this.uploadToken.mode,progress:function(){},success:function(t){var e;s.isShowUploadLoading=!1;var a=s.uploadToken.host+"/"+t,n=t.substr(t.lastIndexOf(".")+1);-1!="jpg,jpeg,png,JPG,JPEG,PNG".indexOf(n)?e="<br><img style='max-width:45%' preview='1' src='"+a+"' />":(e="<br><img style='width:20px;height:20px;top:3px; right:3px;position: relative;' preview='1' src='http://qiniu.cmp520.com/fj.png' />",e+="<a target='_blank' style='color: #2e9dfc;' href='"+a+"'>下载附件</a>"),s.request.source=e,s.$notify({title:"温馨提示！",message:"上传成功~",showClose:!1,type:"success"})},error:function(t){s.isShowUploadLoading=!1,t.response&&t.response.data&&s.$message.error(t.response.data.message)}})}},watch:{prop:function(){var t=this;this.getWorkOrder(),setTimeout((function(){t.$previewRefresh(),t.getComments()}),500)}}},v=h,m=(a("7563"),a("2877")),g=Object(m["a"])(v,r,c,!1,null,"04313ef6",null),w=g.exports,b={name:"workorder-index",components:{WorkOrderView:w},data:function(){return{loading:!0,isShowWorkOrderView:!1,showWorkOrder:{},tableData:{list:[],page_on:1,page_size:10,total:0,status:"",del:0,tid:0},tabIndex:0,del:0,workorderTypes:[{id:0,count:0,title:"全部工单"}]}},computed:{workStatus:function(){return this.tabIndex==this.workorderTypes.length-1&&this.workorderTypes.length>1?"0,1,2,3":"0,1,2"}},created:function(){this.getWorkorderList(),this.getWorkorderTypes()},methods:{onShow:function(t){this.showWorkOrder=t,this.isShowWorkOrderView=!0},tabsChange:function(t){this.tabIndex=parseInt(t.index),this.del=0,this.tabIndex==this.workorderTypes.length-1&&(this.del=1),this.changeType(this.workorderTypes[this.tabIndex].id)},indexMethod:function(t){return(this.tableData.page_on-1)*this.tableData.page_size+t+1},changeType:function(t){this.tableData.tid=t,this.getWorkorderList(1)},getWorkorderList:function(t){var e=this;t&&(this.tableData.page_on=t),this.tableData.status=this.workStatus,this.tableData.del=this.del;var a=this.tableData,s=a.page_on,n=a.page_size,o=a.tid,r=a.status,c=a.del;i.a.post("/workorder/list",{page_on:s,page_size:n,tid:o,status:r,del:c}).then((function(t){e.loading=!1,e.tableData=t.data.data})).catch((function(t){e.loading=!1,e.$message.error(t.response.data.message)}))},getWorkorderTypes:function(){var t=this;i.a.get("/workorder/types").then((function(e){t.workorderTypes=t.workorderTypes.concat(e.data.data);for(var a=0;a<e.data.data.length;a++)t.workorderTypes[0].count+=e.data.data[a].count;t.workorderTypes.push({id:-1,count:0,title:"已结单"}),t.workorderTypes.push({id:-2,count:0,title:"回收站"})})).catch((function(e){t.$message.error(e.response.data.message)}))},handleSizeChange:function(t){this.tableData.page_size=t,this.getWorkorderList()},handleCurrentChange:function(t){this.tableData.page_on=t,this.getWorkorderList()}},watch:{isShowWorkOrderView:function(t){t||this.getWorkorderList()}}},_=b,y=(a("7b0d"),Object(m["a"])(_,s,n,!1,null,"28a53d25",null));e["default"]=y.exports},eb66:function(t,e,a){},f1ae:function(t,e,a){"use strict";var s=a("86cc"),n=a("4630");t.exports=function(t,e,a){e in t?s.f(t,e,n(0,a)):t[e]=a}},f3e2:function(t,e,a){"use strict";var s=a("5ca1"),n=a("0a49")(0),o=a("2f21")([].forEach,!0);s(s.P+s.F*!o,"Array",{forEach:function(t){return n(this,t,arguments[1])}})},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);
//# sourceMappingURL=chunk-cabbc79c.8d69ea53.js.map
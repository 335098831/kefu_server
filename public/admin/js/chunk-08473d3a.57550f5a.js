(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08473d3a"],{"78ce":function(e,t,s){var a=s("5ca1");a(a.S,"Date",{now:function(){return(new Date).getTime()}})},c2a3:function(e,t,s){},caae:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"record-page"},[s("div",{staticClass:"record-mini-im-head"},[s("span",[s("i",{staticClass:"el-icon-time"}),s("span",{attrs:{slot:"title"},slot:"title"},[e._v("服务记录")])])]),s("el-divider"),s("div",{staticClass:"search"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{staticStyle:{width:"120px"}},[s("el-form",{ref:"form",attrs:{"label-width":"120px"}},[s("el-form-item",{attrs:{label:1==e.adminInfo.root?"按客服：":"按日期："}})],1)],1),1==e.adminInfo.root?s("el-col",{attrs:{span:3}},[s("el-select",{attrs:{placeholder:"请选择客服"},on:{change:e.refreshRecord},model:{value:e.selectCustomerId,callback:function(t){e.selectCustomerId=t},expression:"selectCustomerId"}},e._l(e.customerData,(function(e){return s("el-option",{key:e.id,attrs:{label:e.nickname,value:e.id}})})),1)],1):e._e(),s("el-col",{attrs:{span:5.5}},[s("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},on:{change:e.refreshRecord},model:{value:e.selectDate,callback:function(t){e.selectDate=t},expression:"selectDate"}})],1),s("el-col",{attrs:{span:5.5}},[s("el-checkbox",{attrs:{label:"去重目标客户",border:""},on:{change:e.refreshRecord},model:{value:e.isDeWeighting,callback:function(t){e.isDeWeighting=t},expression:"isDeWeighting"}})],1),s("el-col",{attrs:{span:5.5}},[s("el-checkbox",{attrs:{label:"只显示未接待客户",border:""},on:{change:e.refreshRecord},model:{value:e.isReception,callback:function(t){e.isReception=t},expression:"isReception"}})],1)],1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData.list}},[s("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"#序号",width:"60"}}),s("el-table-column",{attrs:{prop:"service_account",label:"接待客服"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.serviceNickname(t.row.service_account)))])]}}])}),s("el-table-column",{attrs:{prop:"nickname",label:"目标客户"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:"success"}},[e._v(e._s(t.row.nickname))])]}}])}),s("el-table-column",{attrs:{prop:"is_reception",label:"是否已接待"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{directives:[{name:"show",rawName:"v-show",value:0==t.row.is_reception,expression:"scope.row.is_reception == 0"}],attrs:{type:"danger"}},[e._v("未接待")]),s("el-tag",{directives:[{name:"show",rawName:"v-show",value:1==t.row.is_reception,expression:"scope.row.is_reception == 1"}],attrs:{type:"success"}},[e._v("已接待")])]}}])}),s("el-table-column",{attrs:{prop:"transfer_account",label:"满意度"}},[[s("span",[e._v("-----")])]],2),s("el-table-column",{attrs:{prop:"platform",label:"客户端平台"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",[e._v(e._s(e.$getPlatformItem(t.row.platform).title))])]}}])}),s("el-table-column",{attrs:{prop:"create_at",label:"服务时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.$formatUnixDate(t.row.create_at,"YYYY/MM/DD HH:mm:ss"))+"\n      ")]}}])}),s("el-table-column",{attrs:{prop:"operating",align:"center",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini"},on:{click:function(s){return e.openModal(t)}}},[e._v("聊天记录")])]}}])})],1),s("el-row",{staticStyle:{"margin-top":"20px"},attrs:{type:"flex",justify:"space-between"}},[s("span",{staticStyle:{color:"#666","font-size":"14px"}},[e._v("共找到"+e._s(e.tableData.total)+"条数据")]),s("el-pagination",{attrs:{background:"",layout:"sizes, prev, pager, next","current-page":e.tableData.page_on,"page-sizes":[5,10,15,20],total:e.tableData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),s("el-dialog",{attrs:{visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[s("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[s("div",{staticStyle:{color:"#666"}},[s("span",{staticStyle:{color:"#e6a23c"}},[e._v(e._s(e.serviceNickname(e.selectUser.service_account)))]),e._v("\n          与\n        "),s("span",{staticStyle:{color:"#67c23a"}},[e._v(e._s(e.selectUser.nickname))]),e._v("\n        的聊天记录\n      ")])]),s("div",{ref:"chatBody",staticClass:"record-modal-chat-box",attrs:{id:"chatBody"}},[s("ChatsComponent",{attrs:{isMessageEnd:e.isMessageEnd,seviceId:e.selectCustomerId+"",seviceNickname:e.serviceNickname(e.selectUser.service_account),messages:e.messageRecord.list,userId:e.selectUser.user_account,userNickname:e.selectUser.nickname,onLoadMor:e.onLoadMor,loading:e.getMessageRecordLoading}})],1)])],1)},i=[],n=(s("78ce"),s("bc3a")),o=s.n(n),c=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mini-im-chat-list"},[s("div",{staticClass:"mini-im-chat-message-box"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"loading"},[s("i",{staticClass:"el-icon-loading"}),s("span",[e._v("消息加载中...")])]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isMessageEnd,expression:"isMessageEnd"}],attrs:{type:"text",disabled:"",icon:"el-icon-refresh-right"}},[e._v("无更多聊天记录...")]),e.isMessageEnd||e.loading?e._e():s("el-button",{attrs:{type:"text",icon:"el-icon-refresh"},on:{click:e.onLoadMor}},[e._v("点击加载更多聊天记录")])],1),s("div",{staticClass:"mini-im-chat-message-box"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.messages.length<=0&&!e.loading,expression:"messages.length <= 0 && !loading"}],staticClass:"loading"},[s("i",{staticClass:"el-icon-time"}),s("span",[e._v("暂无聊天记录...")])])]),e._l(e.messages,(function(t,a){return s("div",{key:a,staticClass:"mini-im-chat-message-box",class:{self:t.from_account!=e.userId}},["text"==t.biz_type||"photo"==t.biz_type||"knowledge"==t.biz_type||"knowledge_list"==t.biz_type?[s("div",{staticClass:"user-date"},[t.from_account==e.seviceId?s("span",[e._v("\n              "+e._s(e.seviceNickname)+"\n            ")]):t.from_account==e.userId?s("span",[e._v("\n              "+e._s(e.userNickname)+"\n            ")]):s("span",[s("span",{staticStyle:{"font-size":"12px",color:"#666"}},[e._v("(机器人)")]),e._v(e._s(e.$robotNickname(t.from_account))+"\n            ")]),s("em",[e._v(e._s(e.$formatFromNowDate(t.timestamp)))])])]:e._e(),"text"==t.biz_type?[s("div",{staticClass:"text"},[s("span",{domProps:{innerHTML:e._s(t.payload.replace(/\n/gi,"<br />"))}})])]:e._e(),"photo"==t.biz_type?[s("div",{staticClass:"photo"},[t.percent&&100!=t.percent?s("div",{staticClass:"loading"},[s("i",{staticClass:"el-icon-loading"}),s("span",[e._v(e._s(t.percent)+"%")])]):e._e(),s("div",{staticClass:"img-content"},[s("img",{attrs:{src:t.payload,preview:"1"}})])])]:e._e(),"transfer"==t.biz_type?[s("div",{staticClass:"system"},[s("span",[e._v(e._s(t.payload))]),s("em",[e._v(e._s(e.$formatFromNowDate(t.timestamp)))])])]:e._e(),"end"==t.biz_type?[s("div",{staticClass:"system"},[t.to_account!=e.adminInfo.id?s("span",[e._v("你结束了会话")]):s("span",[e._v("对方结束了会话")]),s("em",[e._v(e._s(e.$formatFromNowDate(t.timestamp)))])])]:e._e(),"timeout"==t.biz_type?[s("div",{staticClass:"system"},[s("span",[e._v("用户长时间无应答，会话结束")]),s("em",[e._v(e._s(e.$formatFromNowDate(t.timestamp)))])])]:e._e(),"cancel"==t.biz_type?[s("div",{staticClass:"system"},[t.from_account==e.adminInfo.id?s("span",[e._v("您撤回了一条消息")]):s("span",[e._v("对方撤回了一条消息")]),s("em",[e._v(e._s(e.$formatFromNowDate(t.timestamp)))])])]:e._e(),"knowledge"==t.biz_type?[s("div",{staticClass:"knowledge"},[s("div",{staticClass:"content"},[s("div",{staticClass:"title"},[e._v("以下是否是您关心的相关问题呢？")]),e._l(JSON.parse(t.payload),(function(t,a){return s("div",{key:a,staticClass:"item"},[e._v("\n                "+e._s(a+1)+"."+e._s(t.title)+"\n              ")])}))],2)])]:e._e()],2)}))],2)},r=[],l={name:"mini-im-contact",data:function(){return{}},computed:{seviceCurrentUser:function(){return this.$store.getters.seviceCurrentUser||{}},adminInfo:function(){return this.$store.getters.adminInfo||{}}},props:{loading:Boolean,isMessageEnd:Boolean,messages:Array,userId:String,userNickname:String,seviceId:String,seviceNickname:String,onLoadMor:Function},watch:{messages:function(){var e=this;setTimeout((function(){e.$previewRefresh()}),1e3)}}},d=l,g=(s("e775"),s("2877")),m=Object(g["a"])(d,c,r,!1,null,"3d81ef40",null),u=m.exports,p=s("c1df"),h={name:"robot",components:{ChatsComponent:u},data:function(){return{loading:!0,isDeWeighting:!1,isReception:!1,selectDate:Date.now(),tableData:{list:[],page_on:1,page_size:10,cid:0,total:0,is_de_weighting:!1,date:""},customerData:[],selectCustomerId:null,selectUser:{},pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},isMessageEnd:!1,getMessageRecordLoading:!1,getMessageRecordPageSize:20,dialogFormVisible:!1,messageRecord:{list:[]},isFirstRequestMessageEnd:!1}},computed:{platformConfig:function(){return this.$store.getters.platformConfig},adminInfo:function(){return this.$store.getters.adminInfo}},created:function(){this.getAdmins()},mounted:function(){var e=this;setTimeout((function(){e.selectCustomerId=e.adminInfo.id,e.getRecord(1)}),1e3)},methods:{indexMethod:function(e){return(this.tableData.page_on-1)*this.tableData.page_size+e+1},handleSizeChange:function(e){this.tableData.page_size=e,this.getRecord()},handleCurrentChange:function(e){this.tableData.page_on=e,this.getRecord()},serviceNickname:function(e){for(var t="",s=0;s<this.customerData.length;s++)if(this.customerData[s].id==e){t=this.customerData[s].nickname;break}return t},getAdmins:function(){var e=this;o.a.post("/admin/list",{page_on:1,page_size:100,online:3}).then((function(t){e.customerData=t.data.data.list})).catch((function(t){e.$message.error(t.response.data.message)}))},getRecord:function(e){var t=this;this.loading=!0,e&&(this.tableData.page_on=e);var s=this.tableData,a=s.page_on,i=s.page_size;o.a.post("/services_statistical/list",{page_on:a,page_size:i,cid:this.selectCustomerId,date:p(this.selectDate).format("YYYY-MM-DD"),is_de_weighting:this.isDeWeighting,is_reception:this.isReception}).then((function(e){t.loading=!1,t.tableData=e.data.data})).catch((function(e){t.loading=!1,t.$message.error(e.response.data.message)}))},refreshRecord:function(){this.getRecord()},openModal:function(e){this.selectUser=e.row,this.isMessageEnd=!1,this.isFirstRequestMessageEnd=!1,this.dialogFormVisible=!0,this.messageRecord={list:[]},this.getMessageRecord()},getMessageRecord:function(e){var t=this;this.getMessageRecordLoading=!0,void 0==e&&(e=0),o.a.post("/message/list",{timestamp:e,page_size:this.getMessageRecordPageSize,service:parseInt(this.selectCustomerId),account:parseInt(this.selectUser.user_account)}).then((function(s){t.getMessageRecordLoading=!1;for(var a=s.data.data.list,i=0;i<a.length;i++)a[i].payload=window.Base64.decode(a[i].payload);a.length<t.getMessageRecordPageSize&&(t.isFirstRequestMessageEnd=!0),0==a.length||0==e?(t.messageRecord=s.data.data,t.scrollIntoBottom()):(s.data.data.list=a.concat(t.messageRecord.list),t.messageRecord=s.data.data),setTimeout((function(){return t.$previewRefresh()}),500)})).catch((function(e){console.log(e),t.getMessageRecordLoading=!1}))},getHistoryMessageRecord:function(e){var t=this;this.getMessageRecordLoading=!0,void 0!=e&&0!=e?o.a.post("/message/history",{timestamp:e,page_size:this.getMessageRecordPageSize,service:parseInt(this.selectCustomerId),account:parseInt(this.selectUser.user_account)}).then((function(e){for(var s=e.data.data.list,a=0;a<s.length;a++)s[a].payload=window.Base64.decode(s[a].payload);t.getMessageRecordLoading=!1,s.length<t.getMessageRecordPageSize&&(t.isMessageEnd=!0),e.data.data.list=s.concat(t.messageRecord.list),t.messageRecord=e.data.data,setTimeout((function(){return t.$previewRefresh()}),1e3)})).catch((function(){t.getMessageRecordLoading=!1})):this.isMessageEnd=!0},onLoadMor:function(){this.getMessageRecordLoading||(this.isFirstRequestMessageEnd?this.getHistoryMessageRecord(this.messageRecord.list[0].timestamp):this.getMessageRecord(this.messageRecord.list[0].timestamp),setTimeout((function(){var e=document.getElementById("chatBody");e.scrollTop=500}),50))},scrollIntoBottom:function(){try{setTimeout((function(){var e=document.getElementById("chatBody");if(e){var t=e.clientHeight,s=e.scrollHeight;e.scrollTop=s-t}}),50)}catch(e){console.log(e)}}}},f=h,_=(s("fc7d"),Object(g["a"])(f,a,i,!1,null,null,null));t["default"]=_.exports},e6a4:function(e,t,s){},e775:function(e,t,s){"use strict";var a=s("c2a3"),i=s.n(a);i.a},fc7d:function(e,t,s){"use strict";var a=s("e6a4"),i=s.n(a);i.a}}]);
//# sourceMappingURL=chunk-08473d3a.57550f5a.js.map